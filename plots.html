<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Plotting and Data Visualisations | DfT R Cookbook</title>
  <meta name="description" content="Guidance and code examples for R usage for DfT and beyond" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Plotting and Data Visualisations | DfT R Cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Guidance and code examples for R usage for DfT and beyond" />
  <meta name="github-repo" content="departmentfortransport/R-cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Plotting and Data Visualisations | DfT R Cookbook" />
  
  <meta name="twitter:description" content="Guidance and code examples for R usage for DfT and beyond" />
  

<meta name="author" content="Isi Avbulimen, Hannah Bougdah, Tamsin Forbes, Jack Marks, Tim Taylor" />


<meta name="date" content="2021-03-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="factors.html"/>
<link rel="next" href="RAP.html"/>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.17/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="why-do-we-need-another-book.html"><a href="why-do-we-need-another-book.html"><i class="fa fa-check"></i><b>1</b> Why do we need <em>another</em> book?</a><ul>
<li class="chapter" data-level="1.1" data-path="why-do-we-need-another-book.html"><a href="why-do-we-need-another-book.html#coding-standards"><i class="fa fa-check"></i><b>1.1</b> Coding standards</a></li>
<li class="chapter" data-level="1.2" data-path="why-do-we-need-another-book.html"><a href="why-do-we-need-another-book.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="why-do-we-need-another-book.html"><a href="why-do-we-need-another-book.html#work-in-progress"><i class="fa fa-check"></i><b>1.3</b> Work in progress</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> The basics</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#r-family"><i class="fa fa-check"></i><b>2.1</b> R family</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#dft-rrstudio---subject-to-change"><i class="fa fa-check"></i><b>2.2</b> DfT R/RStudio - subject to change</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#rstudio-ide"><i class="fa fa-check"></i><b>2.3</b> RStudio IDE</a><ul>
<li class="chapter" data-level="2.3.1" data-path="basics.html"><a href="basics.html#left-bottom-left-if-you-have-scripts-open"><i class="fa fa-check"></i><b>2.3.1</b> Left (bottom left if you have scripts open)</a></li>
<li class="chapter" data-level="2.3.2" data-path="basics.html"><a href="basics.html#top-right-environment-and-other-tabs"><i class="fa fa-check"></i><b>2.3.2</b> Top right; <strong>Environment</strong>, and other tabs</a></li>
<li class="chapter" data-level="2.3.3" data-path="basics.html"><a href="basics.html#bottom-right"><i class="fa fa-check"></i><b>2.3.3</b> Bottom right</a></li>
<li class="chapter" data-level="2.3.4" data-path="basics.html"><a href="basics.html#other-handy-buttons-in-rstudio-ide"><i class="fa fa-check"></i><b>2.3.4</b> Other handy buttons in RStudio IDE</a></li>
<li class="chapter" data-level="2.3.5" data-path="basics.html"><a href="basics.html#rstudio-menu-bar-a-few-pointers"><i class="fa fa-check"></i><b>2.3.5</b> RStudio menu bar a few pointers</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#projects"><i class="fa fa-check"></i><b>2.4</b> Projects</a><ul>
<li class="chapter" data-level="2.4.1" data-path="basics.html"><a href="basics.html#folders"><i class="fa fa-check"></i><b>2.4.1</b> Folders</a></li>
<li class="chapter" data-level="2.4.2" data-path="basics.html"><a href="basics.html#sessioninfo"><i class="fa fa-check"></i><b>2.4.2</b> sessionInfo()</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#r-memory"><i class="fa fa-check"></i><b>2.5</b> R memory</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#a-note-on-rounding"><i class="fa fa-check"></i><b>2.6</b> A note on rounding</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#assignment-operators---vs"><i class="fa fa-check"></i><b>2.7</b> Assignment operators <code>&lt;-</code> vs <code>=</code></a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#arithmetic-operators"><i class="fa fa-check"></i><b>2.8</b> Arithmetic operators</a></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#relational-operators"><i class="fa fa-check"></i><b>2.9</b> Relational operators</a></li>
<li class="chapter" data-level="2.10" data-path="basics.html"><a href="basics.html#logical-operators"><i class="fa fa-check"></i><b>2.10</b> Logical operators</a></li>
<li class="chapter" data-level="2.11" data-path="basics.html"><a href="basics.html#vectors"><i class="fa fa-check"></i><b>2.11</b> Vectors</a><ul>
<li class="chapter" data-level="2.11.1" data-path="basics.html"><a href="basics.html#vector-types"><i class="fa fa-check"></i><b>2.11.1</b> Types</a></li>
<li class="chapter" data-level="2.11.2" data-path="basics.html"><a href="basics.html#conversion-between-atomic-vector-types"><i class="fa fa-check"></i><b>2.11.2</b> Conversion between atomic vector types</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>3</b> Data Importing/Exporting and interaction with other programmes</a><ul>
<li class="chapter" data-level="3.1" data-path="data-import.html"><a href="data-import.html#libraries"><i class="fa fa-check"></i><b>3.1</b> Libraries</a></li>
<li class="chapter" data-level="3.2" data-path="data-import.html"><a href="data-import.html#star-functions"><i class="fa fa-check"></i><b>3.2</b> Star functions</a></li>
<li class="chapter" data-level="3.3" data-path="data-import.html"><a href="data-import.html#navigating-folders"><i class="fa fa-check"></i><b>3.3</b> Navigating folders</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-import.html"><a href="data-import.html#up"><i class="fa fa-check"></i><b>3.3.1</b> Up</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-import.html"><a href="data-import.html#rds"><i class="fa fa-check"></i><b>3.4</b> .rds</a></li>
<li class="chapter" data-level="3.5" data-path="data-import.html"><a href="data-import.html#csv"><i class="fa fa-check"></i><b>3.5</b> .csv</a></li>
<li class="chapter" data-level="3.6" data-path="data-import.html"><a href="data-import.html#xlsx-and-.xls"><i class="fa fa-check"></i><b>3.6</b> .xlsx and .xls</a><ul>
<li class="chapter" data-level="3.6.1" data-path="data-import.html"><a href="data-import.html#single-worksheet---single-workbook"><i class="fa fa-check"></i><b>3.6.1</b> Single worksheet - single workbook</a></li>
<li class="chapter" data-level="3.6.2" data-path="data-import.html"><a href="data-import.html#single-worksheet---many-workbooks"><i class="fa fa-check"></i><b>3.6.2</b> Single worksheet - many workbooks</a></li>
<li class="chapter" data-level="3.6.3" data-path="data-import.html"><a href="data-import.html#many-worksheets---single-workbook"><i class="fa fa-check"></i><b>3.6.3</b> Many worksheets - single workbook</a></li>
<li class="chapter" data-level="3.6.4" data-path="data-import.html"><a href="data-import.html#many-worksheets---many-workbooks"><i class="fa fa-check"></i><b>3.6.4</b> Many worksheets - many workbooks</a></li>
<li class="chapter" data-level="3.6.5" data-path="data-import.html"><a href="data-import.html#non-rectangular-data---single-worksheet---single-workbook"><i class="fa fa-check"></i><b>3.6.5</b> Non-rectangular data - single worksheet - single workbook</a></li>
<li class="chapter" data-level="3.6.6" data-path="data-import.html"><a href="data-import.html#non-rectangular-data---single-worksheet---many-workbooks"><i class="fa fa-check"></i><b>3.6.6</b> Non-rectangular data - single worksheet - many workbooks</a></li>
<li class="chapter" data-level="3.6.7" data-path="data-import.html"><a href="data-import.html#non-rectangular-data---many-worksheets---single-workbook"><i class="fa fa-check"></i><b>3.6.7</b> Non-rectangular data - many worksheets - single workbook</a></li>
<li class="chapter" data-level="3.6.8" data-path="data-import.html"><a href="data-import.html#non-rectangular-data---many-worksheets---many-workbooks"><i class="fa fa-check"></i><b>3.6.8</b> Non-rectangular data - many worksheets - many workbooks</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data-import.html"><a href="data-import.html#exporting-to-.xlsx"><i class="fa fa-check"></i><b>3.7</b> Exporting to .xlsx</a></li>
<li class="chapter" data-level="3.8" data-path="data-import.html"><a href="data-import.html#sav"><i class="fa fa-check"></i><b>3.8</b> .sav</a></li>
<li class="chapter" data-level="3.9" data-path="data-import.html"><a href="data-import.html#sql"><i class="fa fa-check"></i><b>3.9</b> SQL</a></li>
<li class="chapter" data-level="3.10" data-path="data-import.html"><a href="data-import.html#gcp"><i class="fa fa-check"></i><b>3.10</b> GCP</a><ul>
<li class="chapter" data-level="3.10.1" data-path="data-import.html"><a href="data-import.html#bigquery"><i class="fa fa-check"></i><b>3.10.1</b> BigQuery</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="data-import.html"><a href="data-import.html#copy-data-to-clipboard"><i class="fa fa-check"></i><b>3.11</b> Copy data to clipboard</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>4</b> Table/Data Frame manipulation</a><ul>
<li class="chapter" data-level="4.1" data-path="tables.html"><a href="tables.html#pivot-and-reshape-tables"><i class="fa fa-check"></i><b>4.1</b> Pivot and reshape tables</a></li>
<li class="chapter" data-level="4.2" data-path="tables.html"><a href="tables.html#dropping-and-selecting-columns"><i class="fa fa-check"></i><b>4.2</b> Dropping and selecting columns</a></li>
<li class="chapter" data-level="4.3" data-path="tables.html"><a href="tables.html#rename-variables"><i class="fa fa-check"></i><b>4.3</b> Rename variables</a></li>
<li class="chapter" data-level="4.4" data-path="tables.html"><a href="tables.html#filtering-data"><i class="fa fa-check"></i><b>4.4</b> Filtering data</a></li>
<li class="chapter" data-level="4.5" data-path="tables.html"><a href="tables.html#group-data"><i class="fa fa-check"></i><b>4.5</b> Group data</a></li>
<li class="chapter" data-level="4.6" data-path="tables.html"><a href="tables.html#order-data"><i class="fa fa-check"></i><b>4.6</b> Order data</a></li>
<li class="chapter" data-level="4.7" data-path="tables.html"><a href="tables.html#get-counts-of-data"><i class="fa fa-check"></i><b>4.7</b> Get counts of data</a></li>
<li class="chapter" data-level="4.8" data-path="tables.html"><a href="tables.html#combine-tables"><i class="fa fa-check"></i><b>4.8</b> Combine tables</a></li>
<li class="chapter" data-level="4.9" data-path="tables.html"><a href="tables.html#joining-tables"><i class="fa fa-check"></i><b>4.9</b> Joining tables</a></li>
<li class="chapter" data-level="4.10" data-path="tables.html"><a href="tables.html#select-specific-columns-in-a-join"><i class="fa fa-check"></i><b>4.10</b> Select specific columns in a join</a></li>
<li class="chapter" data-level="4.11" data-path="tables.html"><a href="tables.html#sum-rows-or-columns"><i class="fa fa-check"></i><b>4.11</b> Sum rows or columns</a><ul>
<li class="chapter" data-level="4.11.1" data-path="tables.html"><a href="tables.html#sum-rows"><i class="fa fa-check"></i><b>4.11.1</b> Sum rows</a></li>
<li class="chapter" data-level="4.11.2" data-path="tables.html"><a href="tables.html#sum-columns"><i class="fa fa-check"></i><b>4.11.2</b> Sum columns</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="tables.html"><a href="tables.html#replace-nas-or-other-values"><i class="fa fa-check"></i><b>4.12</b> Replace NAs or other values</a></li>
<li class="chapter" data-level="4.13" data-path="tables.html"><a href="tables.html#reordering-rowscolumns"><i class="fa fa-check"></i><b>4.13</b> Reordering rows/columns</a><ul>
<li class="chapter" data-level="4.13.1" data-path="tables.html"><a href="tables.html#reordering-rows"><i class="fa fa-check"></i><b>4.13.1</b> Reordering rows</a></li>
<li class="chapter" data-level="4.13.2" data-path="tables.html"><a href="tables.html#reordering-columns"><i class="fa fa-check"></i><b>4.13.2</b> Reordering columns</a></li>
</ul></li>
<li class="chapter" data-level="4.14" data-path="tables.html"><a href="tables.html#creating-new-variables"><i class="fa fa-check"></i><b>4.14</b> Creating new variables</a></li>
<li class="chapter" data-level="4.15" data-path="tables.html"><a href="tables.html#summarising-data"><i class="fa fa-check"></i><b>4.15</b> Summarising data</a></li>
<li class="chapter" data-level="4.16" data-path="tables.html"><a href="tables.html#look-up-tables"><i class="fa fa-check"></i><b>4.16</b> Look up tables</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dates-times.html"><a href="dates-times.html"><i class="fa fa-check"></i><b>5</b> Working with dates and times</a><ul>
<li class="chapter" data-level="5.1" data-path="dates-times.html"><a href="dates-times.html#working-with-dates"><i class="fa fa-check"></i><b>5.1</b> Working with dates</a><ul>
<li class="chapter" data-level="5.1.1" data-path="dates-times.html"><a href="dates-times.html#converting-a-character-to-a-date"><i class="fa fa-check"></i><b>5.1.1</b> Converting a character to a date</a></li>
<li class="chapter" data-level="5.1.2" data-path="dates-times.html"><a href="dates-times.html#get-year-from-date"><i class="fa fa-check"></i><b>5.1.2</b> Get year from date</a></li>
<li class="chapter" data-level="5.1.3" data-path="dates-times.html"><a href="dates-times.html#get-month-from-date"><i class="fa fa-check"></i><b>5.1.3</b> Get month from date</a></li>
<li class="chapter" data-level="5.1.4" data-path="dates-times.html"><a href="dates-times.html#get-day-from-date"><i class="fa fa-check"></i><b>5.1.4</b> Get day from date</a></li>
<li class="chapter" data-level="5.1.5" data-path="dates-times.html"><a href="dates-times.html#get-weekday-from-date"><i class="fa fa-check"></i><b>5.1.5</b> Get weekday from date</a></li>
<li class="chapter" data-level="5.1.6" data-path="dates-times.html"><a href="dates-times.html#get-quarter-from-date"><i class="fa fa-check"></i><b>5.1.6</b> Get quarter from date</a></li>
<li class="chapter" data-level="5.1.7" data-path="dates-times.html"><a href="dates-times.html#find-difference-between-two-dates"><i class="fa fa-check"></i><b>5.1.7</b> Find difference between two dates</a></li>
<li class="chapter" data-level="5.1.8" data-path="dates-times.html"><a href="dates-times.html#convert-month-integer-to-character"><i class="fa fa-check"></i><b>5.1.8</b> Convert month (integer to character)</a></li>
<li class="chapter" data-level="5.1.9" data-path="dates-times.html"><a href="dates-times.html#convert-month-character-to-integer"><i class="fa fa-check"></i><b>5.1.9</b> Convert month (character to integer)</a></li>
<li class="chapter" data-level="5.1.10" data-path="dates-times.html"><a href="dates-times.html#merge-separate-date-information-into-a-date"><i class="fa fa-check"></i><b>5.1.10</b> Merge separate date information into a date</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dates-times.html"><a href="dates-times.html#working-with-date-times"><i class="fa fa-check"></i><b>5.2</b> Working with date-times</a><ul>
<li class="chapter" data-level="5.2.1" data-path="dates-times.html"><a href="dates-times.html#converting-a-character-to-a-date-time"><i class="fa fa-check"></i><b>5.2.1</b> Converting a character to a date-time</a></li>
<li class="chapter" data-level="5.2.2" data-path="dates-times.html"><a href="dates-times.html#extract-date-from-date-time-variable"><i class="fa fa-check"></i><b>5.2.2</b> Extract date from date time variable</a></li>
<li class="chapter" data-level="5.2.3" data-path="dates-times.html"><a href="dates-times.html#convert-character-to-hms-time-variable"><i class="fa fa-check"></i><b>5.2.3</b> Convert character to hms (time) variable</a></li>
<li class="chapter" data-level="5.2.4" data-path="dates-times.html"><a href="dates-times.html#extract-hour-from-time"><i class="fa fa-check"></i><b>5.2.4</b> Extract hour from time</a></li>
<li class="chapter" data-level="5.2.5" data-path="dates-times.html"><a href="dates-times.html#extract-minute-from-time"><i class="fa fa-check"></i><b>5.2.5</b> Extract minute from time</a></li>
<li class="chapter" data-level="5.2.6" data-path="dates-times.html"><a href="dates-times.html#extract-second-from-time"><i class="fa fa-check"></i><b>5.2.6</b> Extract second from time</a></li>
<li class="chapter" data-level="5.2.7" data-path="dates-times.html"><a href="dates-times.html#merge-separate-time-information-into-one-variable"><i class="fa fa-check"></i><b>5.2.7</b> Merge separate time information into one variable</a></li>
<li class="chapter" data-level="5.2.8" data-path="dates-times.html"><a href="dates-times.html#find-the-difference-between-two-times"><i class="fa fa-check"></i><b>5.2.8</b> find the difference between two times</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>6</b> Working with factors</a><ul>
<li class="chapter" data-level="6.1" data-path="factors.html"><a href="factors.html#common-uses"><i class="fa fa-check"></i><b>6.1</b> Common uses</a><ul>
<li class="chapter" data-level="6.1.1" data-path="factors.html"><a href="factors.html#tabulation-of-data"><i class="fa fa-check"></i><b>6.1.1</b> Tabulation of data</a></li>
<li class="chapter" data-level="6.1.2" data-path="factors.html"><a href="factors.html#ordering-of-data-for-output"><i class="fa fa-check"></i><b>6.1.2</b> Ordering of data for output</a></li>
<li class="chapter" data-level="6.1.3" data-path="factors.html"><a href="factors.html#statistical-models"><i class="fa fa-check"></i><b>6.1.3</b> Statistical models</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="factors.html"><a href="factors.html#other-things-to-know-about-factors"><i class="fa fa-check"></i><b>6.2</b> Other things to know about factors</a><ul>
<li class="chapter" data-level="6.2.1" data-path="factors.html"><a href="factors.html#renaming-factor-levels"><i class="fa fa-check"></i><b>6.2.1</b> Renaming factor levels</a></li>
<li class="chapter" data-level="6.2.2" data-path="factors.html"><a href="factors.html#combining-factors-does-not-result-in-a-factor"><i class="fa fa-check"></i><b>6.2.2</b> Combining factors does not result in a factor</a></li>
<li class="chapter" data-level="6.2.3" data-path="factors.html"><a href="factors.html#numeric-vectors-that-have-been-read-as-factors"><i class="fa fa-check"></i><b>6.2.3</b> Numeric vectors that have been read as factors</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="factors.html"><a href="factors.html#helpful-packages"><i class="fa fa-check"></i><b>6.3</b> Helpful packages</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plots.html"><a href="plots.html"><i class="fa fa-check"></i><b>7</b> Plotting and Data Visualisations</a><ul>
<li class="chapter" data-level="7.1" data-path="plots.html"><a href="plots.html#plotting-in-base-r"><i class="fa fa-check"></i><b>7.1</b> Plotting in base R</a><ul>
<li class="chapter" data-level="7.1.1" data-path="plots.html"><a href="plots.html#line-charts-in-base-r"><i class="fa fa-check"></i><b>7.1.1</b> Line charts in base R</a></li>
<li class="chapter" data-level="7.1.2" data-path="plots.html"><a href="plots.html#bar-charts-in-base-r"><i class="fa fa-check"></i><b>7.1.2</b> Bar charts in base R</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="plots.html"><a href="plots.html#plotting-withh-ggplot2"><i class="fa fa-check"></i><b>7.2</b> Plotting withh {ggplot2}</a><ul>
<li class="chapter" data-level="7.2.1" data-path="plots.html"><a href="plots.html#line-charts-with-ggplot2"><i class="fa fa-check"></i><b>7.2.1</b> Line charts with {ggplot2}</a></li>
<li class="chapter" data-level="7.2.2" data-path="plots.html"><a href="plots.html#aesthetic-mappings"><i class="fa fa-check"></i><b>7.2.2</b> Aesthetic mappings</a></li>
<li class="chapter" data-level="7.2.3" data-path="plots.html"><a href="plots.html#bar-charts-with-ggplot2"><i class="fa fa-check"></i><b>7.2.3</b> Bar charts with {ggplot2}</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="plots.html"><a href="plots.html#dft-colours"><i class="fa fa-check"></i><b>7.3</b> DfT colours</a></li>
<li class="chapter" data-level="7.4" data-path="plots.html"><a href="plots.html#dft-theme"><i class="fa fa-check"></i><b>7.4</b> DfT Theme</a><ul>
<li class="chapter" data-level="7.4.1" data-path="plots.html"><a href="plots.html#custom-dft-theme"><i class="fa fa-check"></i><b>7.4.1</b> Custom DfT Theme</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="plots.html"><a href="plots.html#more-ggplot2-charts"><i class="fa fa-check"></i><b>7.5</b> More {ggplot2} charts</a><ul>
<li class="chapter" data-level="7.5.1" data-path="plots.html"><a href="plots.html#scatter-plots"><i class="fa fa-check"></i><b>7.5.1</b> Scatter plots</a></li>
<li class="chapter" data-level="7.5.2" data-path="plots.html"><a href="plots.html#horizontal-bar-chart"><i class="fa fa-check"></i><b>7.5.2</b> Horizontal bar chart</a></li>
<li class="chapter" data-level="7.5.3" data-path="plots.html"><a href="plots.html#stacked-bar-chart"><i class="fa fa-check"></i><b>7.5.3</b> Stacked bar chart</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="plots.html"><a href="plots.html#interactive-charts-with-plotly"><i class="fa fa-check"></i><b>7.6</b> Interactive charts with {plotly}</a><ul>
<li class="chapter" data-level="7.6.1" data-path="plots.html"><a href="plots.html#plotly-with-ggplot2"><i class="fa fa-check"></i><b>7.6.1</b> {plotly} with {ggplot2}</a></li>
<li class="chapter" data-level="7.6.2" data-path="plots.html"><a href="plots.html#plot_ly"><i class="fa fa-check"></i><b>7.6.2</b> plot_ly()</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="plots.html"><a href="plots.html#mapping-in-r"><i class="fa fa-check"></i><b>7.7</b> Mapping in R</a><ul>
<li class="chapter" data-level="7.7.1" data-path="plots.html"><a href="plots.html#mapping-with-ggplot2"><i class="fa fa-check"></i><b>7.7.1</b> Mapping with {ggplot2}</a></li>
<li class="chapter" data-level="7.7.2" data-path="plots.html"><a href="plots.html#mapping-with-leaflet"><i class="fa fa-check"></i><b>7.7.2</b> Mapping with {leaflet}</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="RAP.html"><a href="RAP.html"><i class="fa fa-check"></i><b>8</b> DfT RAP guidance</a><ul>
<li class="chapter" data-level="8.1" data-path="RAP.html"><a href="RAP.html#what"><i class="fa fa-check"></i><b>8.1</b> What</a></li>
<li class="chapter" data-level="8.2" data-path="RAP.html"><a href="RAP.html#when"><i class="fa fa-check"></i><b>8.2</b> When</a></li>
<li class="chapter" data-level="8.3" data-path="RAP.html"><a href="RAP.html#additional-resources"><i class="fa fa-check"></i><b>8.3</b> Additional resources</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>9</b> Spatial Analysis in R</a><ul>
<li class="chapter" data-level="9.1" data-path="spatial.html"><a href="spatial.html#what-is-spatial-data"><i class="fa fa-check"></i><b>9.1</b> What is Spatial Data?</a></li>
<li class="chapter" data-level="9.2" data-path="spatial.html"><a href="spatial.html#packages"><i class="fa fa-check"></i><b>9.2</b> Packages</a></li>
<li class="chapter" data-level="9.3" data-path="spatial.html"><a href="spatial.html#reading-in-spatial-data"><i class="fa fa-check"></i><b>9.3</b> Reading in Spatial Data</a></li>
<li class="chapter" data-level="9.4" data-path="spatial.html"><a href="spatial.html#crs-projections"><i class="fa fa-check"></i><b>9.4</b> CRS Projections</a></li>
<li class="chapter" data-level="9.5" data-path="spatial.html"><a href="spatial.html#manipulating-spatial-data"><i class="fa fa-check"></i><b>9.5</b> Manipulating Spatial Data</a></li>
<li class="chapter" data-level="9.6" data-path="spatial.html"><a href="spatial.html#spatial-analysis---joins"><i class="fa fa-check"></i><b>9.6</b> Spatial Analysis - Joins</a></li>
<li class="chapter" data-level="9.7" data-path="spatial.html"><a href="spatial.html#plotting-and-simplifying"><i class="fa fa-check"></i><b>9.7</b> Plotting and simplifying</a></li>
<li class="chapter" data-level="9.8" data-path="spatial.html"><a href="spatial.html#mapping-spatial-data"><i class="fa fa-check"></i><b>9.8</b> Mapping Spatial Data</a></li>
<li class="chapter" data-level="9.9" data-path="spatial.html"><a href="spatial.html#other-spatial-types"><i class="fa fa-check"></i><b>9.9</b> Other Spatial Types</a></li>
<li class="chapter" data-level="9.10" data-path="spatial.html"><a href="spatial.html#further-resources"><i class="fa fa-check"></i><b>9.10</b> Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>10</b> Functions</a><ul>
<li class="chapter" data-level="10.1" data-path="functions.html"><a href="functions.html#user-defined-functions-udfs"><i class="fa fa-check"></i><b>10.1</b> User defined functions (UDFs)</a></li>
<li class="chapter" data-level="10.2" data-path="functions.html"><a href="functions.html#top-tips-for-writing-functions"><i class="fa fa-check"></i><b>10.2</b> Top tips for writing functions</a></li>
<li class="chapter" data-level="10.3" data-path="functions.html"><a href="functions.html#function-structure"><i class="fa fa-check"></i><b>10.3</b> Function structure</a></li>
<li class="chapter" data-level="10.4" data-path="functions.html"><a href="functions.html#function-with-purrr-structure"><i class="fa fa-check"></i><b>10.4</b> Function with <code>purrr</code> structure</a></li>
<li class="chapter" data-level="10.5" data-path="functions.html"><a href="functions.html#add-superscript-to-text-function"><i class="fa fa-check"></i><b>10.5</b> Add superscript to text function</a></li>
<li class="chapter" data-level="10.6" data-path="functions.html"><a href="functions.html#function-to-produce-multiple-graphs"><i class="fa fa-check"></i><b>10.6</b> Function to produce multiple graphs</a></li>
<li class="chapter" data-level="10.7" data-path="functions.html"><a href="functions.html#further-reading"><i class="fa fa-check"></i><b>10.7</b> Further reading</a></li>
<li class="chapter" data-level="10.8" data-path="functions.html"><a href="functions.html#function-to-create-folder-structure-for-r-project"><i class="fa fa-check"></i><b>10.8</b> Function to create folder structure for R project</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DfT R Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="plots" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Plotting and Data Visualisations</h1>
<p>This chapter provides some examples of how to visualise data in R.</p>
<p>For charts, we’ll look at a few examples of how to create simple charts in base R but this chapter will focus mainly in using {ggplot2} to plot charts. For maps, we’ll look at how to produce static choropleth maps using {ggplot2} and how to produce interactive maps using {leaflet}.</p>
<div id="plotting-in-base-r" class="section level2">
<h2><span class="header-section-number">7.1</span> Plotting in base R</h2>
<p>Before we look at using {ggplot2}, we’ll look at how to plot simple charts using functions in base R. We’ll use road accident data from 2005 to 2017 to demonstrate how to create line and bar charts.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="plots.html#cb202-1"></a><span class="co"># read in road accident data</span></span>
<span id="cb202-2"><a href="plots.html#cb202-2"></a>road_acc &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(</span>
<span id="cb202-3"><a href="plots.html#cb202-3"></a>  <span class="dt">file =</span> <span class="st">&quot;data/road_accidents_by_year_and_severity.csv&quot;</span>)</span>
<span id="cb202-4"><a href="plots.html#cb202-4"></a><span class="co">#&gt; </span></span>
<span id="cb202-5"><a href="plots.html#cb202-5"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb202-6"><a href="plots.html#cb202-6"></a><span class="co">#&gt; cols(</span></span>
<span id="cb202-7"><a href="plots.html#cb202-7"></a><span class="co">#&gt;   accident_year = col_double(),</span></span>
<span id="cb202-8"><a href="plots.html#cb202-8"></a><span class="co">#&gt;   accident_severity_id = col_double(),</span></span>
<span id="cb202-9"><a href="plots.html#cb202-9"></a><span class="co">#&gt;   name = col_character(),</span></span>
<span id="cb202-10"><a href="plots.html#cb202-10"></a><span class="co">#&gt;   total = col_double()</span></span>
<span id="cb202-11"><a href="plots.html#cb202-11"></a><span class="co">#&gt; )</span></span>
<span id="cb202-12"><a href="plots.html#cb202-12"></a><span class="kw">head</span>(road_acc)</span></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:right;">
accident_year
</th>
<th style="text-align:right;">
accident_severity_id
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
total
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Fatal
</td>
<td style="text-align:right;">
2913
</td>
</tr>
<tr>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Serious
</td>
<td style="text-align:right;">
25029
</td>
</tr>
<tr>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Slight
</td>
<td style="text-align:right;">
170793
</td>
</tr>
<tr>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Fatal
</td>
<td style="text-align:right;">
2926
</td>
</tr>
<tr>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Serious
</td>
<td style="text-align:right;">
24946
</td>
</tr>
<tr>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Slight
</td>
<td style="text-align:right;">
161289
</td>
</tr>
</tbody>
</table>
</div>
<div id="line-charts-in-base-r" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Line charts in base R</h3>
<p>We want to plot a line chart of total road accidents against year. First we need to group our data by accident year and summarise to get a total sum of accidents for each year:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="plots.html#cb203-1"></a>road_acc_total &lt;-<span class="st"> </span>road_acc <span class="op">%&gt;%</span></span>
<span id="cb203-2"><a href="plots.html#cb203-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(accident_year) <span class="op">%&gt;%</span></span>
<span id="cb203-3"><a href="plots.html#cb203-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">sum</span>(total))</span></code></pre></div>
<p>We’ll now use the base R function ‘plot’, specifying the x and y axis and well as the plot type ‘l’ for line charts:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="plots.html#cb204-1"></a><span class="kw">plot</span>(</span>
<span id="cb204-2"><a href="plots.html#cb204-2"></a>  <span class="dt">x =</span> road_acc_total<span class="op">$</span>accident_year,</span>
<span id="cb204-3"><a href="plots.html#cb204-3"></a>  <span class="dt">y =</span> road_acc_total<span class="op">$</span>total,</span>
<span id="cb204-4"><a href="plots.html#cb204-4"></a>  <span class="dt">type =</span> <span class="st">&quot;l&quot;</span></span>
<span id="cb204-5"><a href="plots.html#cb204-5"></a>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-186-1.png" width="672" /></p>
<p>We can make our plot look better by specifying a colour, labelling the axes and giving our plot a title:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="plots.html#cb205-1"></a><span class="kw">plot</span>(</span>
<span id="cb205-2"><a href="plots.html#cb205-2"></a>  <span class="dt">x =</span> road_acc_total<span class="op">$</span>accident_year,</span>
<span id="cb205-3"><a href="plots.html#cb205-3"></a>  <span class="dt">y =</span> road_acc_total<span class="op">$</span>total,</span>
<span id="cb205-4"><a href="plots.html#cb205-4"></a>  <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb205-5"><a href="plots.html#cb205-5"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb205-6"><a href="plots.html#cb205-6"></a>  <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb205-7"><a href="plots.html#cb205-7"></a>  <span class="dt">ylab =</span> <span class="st">&quot;Total&quot;</span>,</span>
<span id="cb205-8"><a href="plots.html#cb205-8"></a>  <span class="dt">main =</span> <span class="st">&quot;Total road accidents per year, 2005 - 2017&quot;</span></span>
<span id="cb205-9"><a href="plots.html#cb205-9"></a>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-187-1.png" width="672" /></p>
<p>We can also force our plot to start at 0:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="plots.html#cb206-1"></a><span class="kw">plot</span>(</span>
<span id="cb206-2"><a href="plots.html#cb206-2"></a>  <span class="dt">x =</span> road_acc_total<span class="op">$</span>accident_year,</span>
<span id="cb206-3"><a href="plots.html#cb206-3"></a>  <span class="dt">y =</span> road_acc_total<span class="op">$</span>total,</span>
<span id="cb206-4"><a href="plots.html#cb206-4"></a>  <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb206-5"><a href="plots.html#cb206-5"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb206-6"><a href="plots.html#cb206-6"></a>  <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb206-7"><a href="plots.html#cb206-7"></a>  <span class="dt">ylab =</span> <span class="st">&quot;Total&quot;</span>,</span>
<span id="cb206-8"><a href="plots.html#cb206-8"></a>  <span class="dt">main =</span> <span class="st">&quot;Total road accidents per year, 2005 - 2017&quot;</span>,</span>
<span id="cb206-9"><a href="plots.html#cb206-9"></a>  <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(road_acc_total<span class="op">$</span>total))</span>
<span id="cb206-10"><a href="plots.html#cb206-10"></a>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-188-1.png" width="672" /></p>
</div>
<div id="bar-charts-in-base-r" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Bar charts in base R</h3>
<p>We want to plot a bar chart showing the total number of accidents of each severity in 2017. First let’s filter the road accidents data for 2017:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="plots.html#cb207-1"></a>road_acc_<span class="dv">2017</span> &lt;-<span class="st"> </span>road_acc <span class="op">%&gt;%</span></span>
<span id="cb207-2"><a href="plots.html#cb207-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(accident_year <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>)</span>
<span id="cb207-3"><a href="plots.html#cb207-3"></a>road_acc_<span class="dv">2017</span></span></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:right;">
accident_year
</th>
<th style="text-align:right;">
accident_severity_id
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
total
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Fatal
</td>
<td style="text-align:right;">
1676
</td>
</tr>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Serious
</td>
<td style="text-align:right;">
22534
</td>
</tr>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Slight
</td>
<td style="text-align:right;">
105772
</td>
</tr>
</tbody>
</table>
</div>
<p>To create a bar chart, we use the base R function ‘barplot’ and then specify the variable we want to plot as the height argument:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="plots.html#cb208-1"></a><span class="kw">barplot</span>(<span class="dt">height =</span> road_acc_<span class="dv">2017</span><span class="op">$</span>total)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-191-1.png" width="672" /></p>
<p>This isn’t very useful as we can’t see what the different severity types are. So we can specify these in the names.arg argument, as well as add a few extra features to make the plot look better:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="plots.html#cb209-1"></a><span class="kw">barplot</span>(<span class="dt">height =</span> road_acc_<span class="dv">2017</span><span class="op">$</span>total,</span>
<span id="cb209-2"><a href="plots.html#cb209-2"></a>        <span class="dt">names.arg =</span> <span class="kw">c</span>(<span class="st">&quot;Fatal&quot;</span>, <span class="st">&quot;Serious&quot;</span>, <span class="st">&quot;Slight&quot;</span>),</span>
<span id="cb209-3"><a href="plots.html#cb209-3"></a>        <span class="dt">width =</span> <span class="dv">2</span>, <span class="co">#width of the bars</span></span>
<span id="cb209-4"><a href="plots.html#cb209-4"></a>        <span class="dt">col =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb209-5"><a href="plots.html#cb209-5"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Severity&quot;</span>,</span>
<span id="cb209-6"><a href="plots.html#cb209-6"></a>        <span class="dt">ylab =</span> <span class="st">&quot;Total accidents&quot;</span>,</span>
<span id="cb209-7"><a href="plots.html#cb209-7"></a>        <span class="dt">main =</span> <span class="st">&quot;Total accidents by severity, 2017&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-192-1.png" width="672" /></p>
</div>
</div>
<div id="plotting-withh-ggplot2" class="section level2">
<h2><span class="header-section-number">7.2</span> Plotting withh {ggplot2}</h2>
<p><strong>What is {ggplot2}?</strong></p>
<p>The ‘gg’ in {ggplot2} stands for ‘grammar of graphics’. This is a way of thinking about plotting as having grammar elements that can be applied in succession to create a plot. This is the idea that you can build every graph from the same few components: a dataset, geoms (marks representing data points), a co-ordinate system and some other things.</p>
<p>The ggplot() function from the {ggplot2} package is how you create these plots. You build up the graphical elements using the + symbol. Think about it as placing down a canvas and then adding layers on top.</p>
<p><strong>Why should I use {ggplot2} instead of the plot functions in base R?</strong></p>
<p>As with most things in R, there are multiple ways to do the same thing. This applies to creating visualisations as well. As will be demonstrated below we can replicate the graphs we have created above using {ggplot2} instead, pretty well.</p>
<p>One method is not necessarily better than the other, but at DfT we advocate using {ggplot2} when plotting charts. There is consistency in the way that {ggplot2} works which makes it easier to get to grips with for beginners. It is also part of the {tidyverse} which we have used earlier on in this cookbook so it shares the underlying design philosophy, grammar, and data structures.</p>
<div id="line-charts-with-ggplot2" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Line charts with {ggplot2}</h3>
<p>When plotting with {ggplot2}, we start with the ggplot() function which creates a blank canvas, then the next layer we add is the plot type. For line charts, this would be ggplot() + geom_line(). Within these functions, we specify our data and our aesthetic mappings i.e. what variables to map to the x and y axes from the specified data. If we were create a simple line chart for total accidents against year, the code would read as follows:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="plots.html#cb210-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc_total) <span class="op">+</span></span>
<span id="cb210-2"><a href="plots.html#cb210-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> accident_year, <span class="dt">y =</span> total))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-193-1.png" width="672" /></p>
<p>So a reusuable template for making graphs would be as below, with the bracketed sections in the code replaced with a dataset, a geom function and a collection of mappings:</p>
<p>ggplot(data = name_of_dataset) +
geom_function(mapping = aes())</p>
<p>You can find a range of different plot types available in {ggplot2}, as well as tips on how to use them in the {ggplot2} cheatsheet (<a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf</a>).</p>
<p>Let’s create the same the line chart we created with base R, showing total road accidents against year:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="plots.html#cb211-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc_total) <span class="op">+</span></span>
<span id="cb211-2"><a href="plots.html#cb211-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> accident_year, <span class="dt">y =</span> total), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb211-3"><a href="plots.html#cb211-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></span>
<span id="cb211-4"><a href="plots.html#cb211-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total&quot;</span>) <span class="op">+</span></span>
<span id="cb211-5"><a href="plots.html#cb211-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total road accidents per year, 2005 - 2017&quot;</span>) <span class="op">+</span></span>
<span id="cb211-6"><a href="plots.html#cb211-6"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">2000</span>, <span class="dv">2017</span>, <span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb211-7"><a href="plots.html#cb211-7"></a><span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb211-8"><a href="plots.html#cb211-8"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-194-1.png" width="672" /></p>
<p>Here we have specified the colour of the line (notice this is outside of the aes() function). We have also labelled the x and y axes and given the plot a title.
We have used scale_x_continuous() function to specify the intervals in the year variable and have used a theme to set the style of our plot (more on this later).</p>
</div>
<div id="aesthetic-mappings" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Aesthetic mappings</h3>
<p>To get more insight into our data, we can add a third variable to our plot by mapping it to an aesthetic. This is a visual property of the objects in our plot such as the size, the shape or the colour of our points. For example, if we want to see the total number of road accidents by severity type against year, we can map the ‘name’ variable to the colour aesthetic:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="plots.html#cb212-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc) <span class="op">+</span></span>
<span id="cb212-2"><a href="plots.html#cb212-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> accident_year, <span class="dt">y =</span> total, <span class="dt">colour =</span> name)) <span class="op">+</span></span>
<span id="cb212-3"><a href="plots.html#cb212-3"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">2000</span>, <span class="dv">2017</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-195-1.png" width="672" /></p>
<p>So unlike before, we specify the colour within the aes() function, rather than outside of it.</p>
</div>
<div id="bar-charts-with-ggplot2" class="section level3">
<h3><span class="header-section-number">7.2.3</span> Bar charts with {ggplot2}</h3>
<p>When creating bar charts with {ggplot2}, we can use geom_bar() or geom_col(). geom_bar() makes the height of the bar proportional to the number of cases in each group while geom_col() enables the heights of the bars to represent values in the data. So if your data is not already grouped you can use geom_bar() like so:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="plots.html#cb213-1"></a>messy_pokemon &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(</span>
<span id="cb213-2"><a href="plots.html#cb213-2"></a>  <span class="dt">file =</span> <span class="st">&quot;data/messy_pokemon_data.csv&quot;</span>)</span>
<span id="cb213-3"><a href="plots.html#cb213-3"></a><span class="kw">head</span>(messy_pokemon)</span></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
species
</th>
<th style="text-align:left;">
combat_power
</th>
<th style="text-align:right;">
hit_points
</th>
<th style="text-align:right;">
weight_kg
</th>
<th style="text-align:left;">
weight_bin
</th>
<th style="text-align:right;">
height_m
</th>
<th style="text-align:left;">
height_bin
</th>
<th style="text-align:left;">
fast_attack
</th>
<th style="text-align:left;">
charge_attack
</th>
<th style="text-align:left;">
date_first_capture
</th>
<th style="text-align:left;">
time_first_capture
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
abra
</td>
<td style="text-align:left;">
101
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
17.18
</td>
<td style="text-align:left;">
normal
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
zen_headbutt
</td>
<td style="text-align:left;">
shadow_ball
</td>
<td style="text-align:left;">
31 May 1977
</td>
<td style="text-align:left;">
20:59:33
</td>
</tr>
<tr>
<td style="text-align:left;">
abra
</td>
<td style="text-align:left;">
81
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
25.94
</td>
<td style="text-align:left;">
extra_large
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
zen_headbutt
</td>
<td style="text-align:left;">
shadow_ball
</td>
<td style="text-align:left;">
24 February 1973
</td>
<td style="text-align:left;">
10:18:40
</td>
</tr>
<tr>
<td style="text-align:left;">
bellsprout
</td>
<td style="text-align:left;">
156
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
5.85
</td>
<td style="text-align:left;">
extra_large
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
acid
</td>
<td style="text-align:left;">
sludge_bomb
</td>
<td style="text-align:left;">
21 June 1924
</td>
<td style="text-align:left;">
08:06:55
</td>
</tr>
<tr>
<td style="text-align:left;">
bellsprout
</td>
<td style="text-align:left;">
262
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
5.42
</td>
<td style="text-align:left;">
extra_large
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
acid
</td>
<td style="text-align:left;">
sludge_bomb
</td>
<td style="text-align:left;">
01 August 1925
</td>
<td style="text-align:left;">
11:18:28
</td>
</tr>
<tr>
<td style="text-align:left;">
bellsprout
</td>
<td style="text-align:left;">
389
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
3.40
</td>
<td style="text-align:left;">
normal
</td>
<td style="text-align:right;">
0.66
</td>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
vine_whip
</td>
<td style="text-align:left;">
wrap
</td>
<td style="text-align:left;">
06 August 1952
</td>
<td style="text-align:left;">
21:11:42
</td>
</tr>
<tr>
<td style="text-align:left;">
bellsprout
</td>
<td style="text-align:left;">
433
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
6.67
</td>
<td style="text-align:left;">
extra_large
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
acid
</td>
<td style="text-align:left;">
power_whip
</td>
<td style="text-align:left;">
17 January 1915
</td>
<td style="text-align:left;">
13:30:41
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="plots.html#cb214-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> messy_pokemon) <span class="op">+</span></span>
<span id="cb214-2"><a href="plots.html#cb214-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> weight_bin))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-196-1.png" width="672" /></p>
<p>This has grouped our data by weight_bin with the height of the bars representing the number of pokemon in each weight bin.</p>
<p>Let’s recreate the total accidents by severity chart, now using {ggplot2} instead:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="plots.html#cb215-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc_<span class="dv">2017</span>) <span class="op">+</span></span>
<span id="cb215-2"><a href="plots.html#cb215-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> name, <span class="dt">y =</span> total), <span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></span>
<span id="cb215-3"><a href="plots.html#cb215-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Severity&quot;</span>) <span class="op">+</span></span>
<span id="cb215-4"><a href="plots.html#cb215-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total accidents&quot;</span>) <span class="op">+</span></span>
<span id="cb215-5"><a href="plots.html#cb215-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total accidents by severity, 2017&quot;</span>)<span class="op">+</span></span>
<span id="cb215-6"><a href="plots.html#cb215-6"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-197-1.png" width="672" /></p>
<p>Here we have used geom_col() instead but our data is already grouped so we simply want the height of the bars to represent the values in the data i.e. the number of accidents of each type of severity.</p>
<p>You could also use geom_bar() in this situation but you would need to add an extra argument: stat = “identity”.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="plots.html#cb216-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc_<span class="dv">2017</span>) <span class="op">+</span></span>
<span id="cb216-2"><a href="plots.html#cb216-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> name, <span class="dt">y =</span> total),  <span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="op">+</span></span>
<span id="cb216-3"><a href="plots.html#cb216-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Severity&quot;</span>) <span class="op">+</span></span>
<span id="cb216-4"><a href="plots.html#cb216-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total accidents&quot;</span>) <span class="op">+</span></span>
<span id="cb216-5"><a href="plots.html#cb216-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total accidents by severity, 2017&quot;</span>) <span class="op">+</span></span>
<span id="cb216-6"><a href="plots.html#cb216-6"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-198-1.png" width="672" /></p>
</div>
</div>
<div id="dft-colours" class="section level2">
<h2><span class="header-section-number">7.3</span> DfT colours</h2>
<p>So far we’ve used colours built into R and referred to them by name e.g. red, lightlue etc. In order to make charts using DfT colours, we can specify what colours we want using hexcodes. For example, for the previous bar chart we can set the levels of severity to different DfT colours.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="plots.html#cb217-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc_<span class="dv">2017</span>) <span class="op">+</span></span>
<span id="cb217-2"><a href="plots.html#cb217-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> name, <span class="dt">y =</span> total, <span class="dt">fill =</span> name))<span class="op">+</span></span>
<span id="cb217-3"><a href="plots.html#cb217-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Severity&quot;</span>) <span class="op">+</span></span>
<span id="cb217-4"><a href="plots.html#cb217-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total accidents&quot;</span>) <span class="op">+</span></span>
<span id="cb217-5"><a href="plots.html#cb217-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total accidents by severity, 2017&quot;</span>) <span class="op">+</span></span>
<span id="cb217-6"><a href="plots.html#cb217-6"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb217-7"><a href="plots.html#cb217-7"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#C99212&quot;</span>, <span class="st">&quot;#D25F15&quot;</span>, <span class="st">&quot;#006853&quot;</span>))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-199-1.png" width="672" /></p>
<p>Here we map the name variable to the fill argument within the aesthetic.</p>
</div>
<div id="dft-theme" class="section level2">
<h2><span class="header-section-number">7.4</span> DfT Theme</h2>
<p>We mentioned themes earlier. Themes are used to set the style of your plot and can give your plots a consistent customized look. You can customise things such as titles, labels, fonts, background, gridlines, and legends. We have been using theme_classic() so far but {ggplot2} has a number of built-in themes that you can use for your plots available here: <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">https://ggplot2.tidyverse.org/reference/ggtheme.html</a></p>
<p>You can modify aspects of a theme using the theme() function. For example, for our previous accidents plot, we can remove the legend title and move the position of the plot title.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="plots.html#cb218-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc_<span class="dv">2017</span>) <span class="op">+</span></span>
<span id="cb218-2"><a href="plots.html#cb218-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> name, <span class="dt">y =</span> total, <span class="dt">fill =</span> name))<span class="op">+</span></span>
<span id="cb218-3"><a href="plots.html#cb218-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Severity&quot;</span>) <span class="op">+</span></span>
<span id="cb218-4"><a href="plots.html#cb218-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total accidents&quot;</span>) <span class="op">+</span></span>
<span id="cb218-5"><a href="plots.html#cb218-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total accidents by severity, 2017&quot;</span>) <span class="op">+</span></span>
<span id="cb218-6"><a href="plots.html#cb218-6"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb218-7"><a href="plots.html#cb218-7"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#C99212&quot;</span>, <span class="st">&quot;#D25F15&quot;</span>, <span class="st">&quot;#006853&quot;</span>))<span class="op">+</span></span>
<span id="cb218-8"><a href="plots.html#cb218-8"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb218-9"><a href="plots.html#cb218-9"></a>        <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-200-1.png" width="672" /></p>
<div id="custom-dft-theme" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Custom DfT Theme</h3>
<p>Instead of using the built-in themes, we can create our own theme to apply to our plots. Below I have created a ‘DfT theme’ for line charts which sets things such as the font types, sizes, axes lines and title positions to make the plot consistent with what we might put in a DfT publication.</p>
<p>You can adjust and tweak this theme and the colours to create plots in the correct style for your own publications.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="plots.html#cb219-1"></a><span class="co"># set DfT colours</span></span>
<span id="cb219-2"><a href="plots.html#cb219-2"></a>dft_colour &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#006853&quot;</span>, <span class="co"># dark green</span></span>
<span id="cb219-3"><a href="plots.html#cb219-3"></a>                    <span class="st">&quot;#66A498&quot;</span>, <span class="co"># light green</span></span>
<span id="cb219-4"><a href="plots.html#cb219-4"></a>                    <span class="st">&quot;#D25F15&quot;</span>, <span class="co"># orange</span></span>
<span id="cb219-5"><a href="plots.html#cb219-5"></a>                    <span class="st">&quot;#E49F73&quot;</span>, <span class="co"># light orange</span></span>
<span id="cb219-6"><a href="plots.html#cb219-6"></a>                    <span class="st">&quot;#C99212&quot;</span>, <span class="co"># yellow</span></span>
<span id="cb219-7"><a href="plots.html#cb219-7"></a>                    <span class="st">&quot;#E9D3A0&quot;</span>, <span class="co"># pale yellow</span></span>
<span id="cb219-8"><a href="plots.html#cb219-8"></a>                    <span class="st">&quot;#0099A9&quot;</span>, <span class="co"># blue</span></span>
<span id="cb219-9"><a href="plots.html#cb219-9"></a>                    <span class="st">&quot;#99D6DD&quot;</span>) <span class="co"># light blue</span></span>
<span id="cb219-10"><a href="plots.html#cb219-10"></a><span class="co"># create theme</span></span>
<span id="cb219-11"><a href="plots.html#cb219-11"></a><span class="co"># note: &#39;sans&#39; in R refers to the font &#39;Arial&#39; in Windows</span></span>
<span id="cb219-12"><a href="plots.html#cb219-12"></a>theme_dft &lt;-<span class="st"> </span>ggplot2<span class="op">::</span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;sans&quot;</span>, <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), <span class="co"># axis text</span></span>
<span id="cb219-13"><a href="plots.html#cb219-13"></a>                            <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;sans&quot;</span>, <span class="dt">size =</span> <span class="dv">13</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="co"># x axis title</span></span>
<span id="cb219-14"><a href="plots.html#cb219-14"></a>                                                        <span class="dt">margin =</span> <span class="kw">margin</span>(<span class="dt">t =</span> <span class="dv">10</span>)),</span>
<span id="cb219-15"><a href="plots.html#cb219-15"></a>                            <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb219-16"><a href="plots.html#cb219-16"></a>                            <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>, <span class="dt">family =</span> <span class="st">&quot;sans&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb219-17"><a href="plots.html#cb219-17"></a>                            <span class="dt">plot.subtitle =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">13</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">hjust =</span> <span class="fl">-0.05</span>,</span>
<span id="cb219-18"><a href="plots.html#cb219-18"></a>                                                         <span class="dt">margin =</span> <span class="kw">margin</span>(<span class="dt">t =</span> <span class="dv">10</span>)),</span>
<span id="cb219-19"><a href="plots.html#cb219-19"></a>                            <span class="dt">legend.key =</span> <span class="kw">element_blank</span>(), <span class="co"># make the legend background blank</span></span>
<span id="cb219-20"><a href="plots.html#cb219-20"></a>                            <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="co"># legend at the bottom</span></span>
<span id="cb219-21"><a href="plots.html#cb219-21"></a>                            <span class="dt">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>, <span class="co"># legend horizontal</span></span>
<span id="cb219-22"><a href="plots.html#cb219-22"></a>                            <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), <span class="co"># remove legend title</span></span>
<span id="cb219-23"><a href="plots.html#cb219-23"></a>                            <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">9</span>, <span class="dt">family =</span> <span class="st">&quot;sans&quot;</span>),</span>
<span id="cb219-24"><a href="plots.html#cb219-24"></a>                            <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="co"># remove tick marks</span></span>
<span id="cb219-25"><a href="plots.html#cb219-25"></a>                            <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(), <span class="co"># remove grid lines</span></span>
<span id="cb219-26"><a href="plots.html#cb219-26"></a>                            <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="co"># remove background</span></span>
<span id="cb219-27"><a href="plots.html#cb219-27"></a>                            <span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))  </span>
<span id="cb219-28"><a href="plots.html#cb219-28"></a><span class="co"># use the DfT colours and the DfT theme for the accidents by severity line chart</span></span>
<span id="cb219-29"><a href="plots.html#cb219-29"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc) <span class="op">+</span></span>
<span id="cb219-30"><a href="plots.html#cb219-30"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> accident_year, <span class="dt">y =</span> total, <span class="dt">colour =</span> name), <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb219-31"><a href="plots.html#cb219-31"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Accidents by severity, 2005 to 2017&quot;</span>, </span>
<span id="cb219-32"><a href="plots.html#cb219-32"></a>       <span class="dt">x =</span> <span class="st">&quot;Accident Year&quot;</span>, </span>
<span id="cb219-33"><a href="plots.html#cb219-33"></a>       <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)<span class="op">+</span></span>
<span id="cb219-34"><a href="plots.html#cb219-34"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">2005</span>, <span class="dv">2017</span>, <span class="dv">2</span>))<span class="op">+</span></span>
<span id="cb219-35"><a href="plots.html#cb219-35"></a><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> dft_colour) <span class="op">+</span><span class="st"> </span><span class="co">#here is where you apply the dft colours</span></span>
<span id="cb219-36"><a href="plots.html#cb219-36"></a><span class="st">  </span>theme_dft <span class="co">#here we specify our custom theme</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-201-1.png" width="672" /></p>
</div>
</div>
<div id="more-ggplot2-charts" class="section level2">
<h2><span class="header-section-number">7.5</span> More {ggplot2} charts</h2>
<p>This section provides more code examples for creating {ggplot2} themes, including the DfT theme code.</p>
<p>First, some more record-level road accident data is read in which can be used with the charts. Note that the data is being read in as a .rds object. A .rds object is an R data object which can be read in as a data frame:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="plots.html#cb220-1"></a><span class="co"># read in road accident data</span></span>
<span id="cb220-2"><a href="plots.html#cb220-2"></a>road_acc_data &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_rds</span>(<span class="st">&quot;data/road_accidents_2017.RDS&quot;</span>)</span>
<span id="cb220-3"><a href="plots.html#cb220-3"></a><span class="kw">head</span>(road_acc_data)</span></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Location_Easting_OSGR
</th>
<th style="text-align:right;">
Location_Northing_OSGR
</th>
<th style="text-align:right;">
Longitude
</th>
<th style="text-align:right;">
Latitude
</th>
<th style="text-align:right;">
Police_Force
</th>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Number_of_Vehicles
</th>
<th style="text-align:right;">
Number_of_Casualties
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:left;">
Time
</th>
<th style="text-align:right;">
Local_Authority_(District)
</th>
<th style="text-align:left;">
Local_Authority_(Highway)
</th>
<th style="text-align:right;">
1st_Road_Class
</th>
<th style="text-align:right;">
1st_Road_Number
</th>
<th style="text-align:right;">
Road_Type
</th>
<th style="text-align:right;">
Speed_limit
</th>
<th style="text-align:right;">
Junction_Detail
</th>
<th style="text-align:right;">
Junction_Control
</th>
<th style="text-align:right;">
2nd_Road_Class
</th>
<th style="text-align:right;">
2nd_Road_Number
</th>
<th style="text-align:right;">
Pedestrian_Crossing-Human_Control
</th>
<th style="text-align:right;">
Pedestrian_Crossing-Physical_Facilities
</th>
<th style="text-align:right;">
Light_Conditions
</th>
<th style="text-align:right;">
Weather_Conditions
</th>
<th style="text-align:right;">
Road_Surface_Conditions
</th>
<th style="text-align:right;">
Special_Conditions_at_Site
</th>
<th style="text-align:right;">
Carriageway_Hazards
</th>
<th style="text-align:right;">
Urban_or_Rural_Area
</th>
<th style="text-align:right;">
Did_Police_Officer_Attend_Scene_of_Accident
</th>
<th style="text-align:left;">
LSOA_of_Accident_Location
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010001708
</td>
<td style="text-align:right;">
532920
</td>
<td style="text-align:right;">
196330
</td>
<td style="text-align:right;">
-0.080107
</td>
<td style="text-align:right;">
51.65006
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-08-05
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
1899-12-31 03:12:00
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:left;">
E09000010
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
105
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
E01001450
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009342
</td>
<td style="text-align:right;">
526790
</td>
<td style="text-align:right;">
181970
</td>
<td style="text-align:right;">
-0.173845
</td>
<td style="text-align:right;">
51.52242
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1899-12-31 01:30:00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
E09000033
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
E01004702
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009344
</td>
<td style="text-align:right;">
535200
</td>
<td style="text-align:right;">
181260
</td>
<td style="text-align:right;">
-0.052969
</td>
<td style="text-align:right;">
51.51410
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1899-12-31 00:30:00
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
E09000030
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
E01004298
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009348
</td>
<td style="text-align:right;">
534340
</td>
<td style="text-align:right;">
193560
</td>
<td style="text-align:right;">
-0.060658
</td>
<td style="text-align:right;">
51.62483
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1899-12-31 01:11:00
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:left;">
E09000010
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1010
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
154
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
E01001429
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009350
</td>
<td style="text-align:right;">
533680
</td>
<td style="text-align:right;">
187820
</td>
<td style="text-align:right;">
-0.072372
</td>
<td style="text-align:right;">
51.57341
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1899-12-31 01:42:00
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
E09000012
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
107
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
E01001808
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009351
</td>
<td style="text-align:right;">
514510
</td>
<td style="text-align:right;">
172370
</td>
<td style="text-align:right;">
-0.353876
</td>
<td style="text-align:right;">
51.43876
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1899-12-31 03:31:00
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:left;">
E09000027
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
E01003900
</td>
</tr>
</tbody>
</table>
</div>
<div id="scatter-plots" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Scatter plots</h3>
<p>The scatter plot example will plot the number of accidents in 2017 for each police force.</p>
<p>To create a scatter plot use <strong>geom_point</strong> in the ggplot2 code.</p>
<p>Note that to draw out a colour for the points, the code specifies which colour in the list of DfT colours (see DfT colours sub-chapter 7.4) the points will be. In this case, the third colour in the list will be the colour of the points.</p>
<p>Labels are added to the scatter plot using <strong>geom_text</strong>.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="plots.html#cb221-1"></a><span class="co"># First get total number of accidents for each police force</span></span>
<span id="cb221-2"><a href="plots.html#cb221-2"></a>accident_pf &lt;-<span class="st"> </span>road_acc_data <span class="op">%&gt;%</span></span>
<span id="cb221-3"><a href="plots.html#cb221-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(Police_Force) <span class="op">%&gt;%</span></span>
<span id="cb221-4"><a href="plots.html#cb221-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">tally</span>()</span>
<span id="cb221-5"><a href="plots.html#cb221-5"></a><span class="co"># use the DfT colours and the DfT theme for the accidents by police force scatter chart</span></span>
<span id="cb221-6"><a href="plots.html#cb221-6"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> accident_pf, <span class="kw">aes</span>(<span class="dt">x =</span> Police_Force, <span class="dt">y =</span> n)) <span class="op">+</span></span>
<span id="cb221-7"><a href="plots.html#cb221-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> dft_colour[<span class="dv">3</span>], <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb221-8"><a href="plots.html#cb221-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Reported Road Accidents by Police Force&quot;</span>, </span>
<span id="cb221-9"><a href="plots.html#cb221-9"></a>       <span class="dt">x =</span> <span class="st">&quot;Police Force&quot;</span>, </span>
<span id="cb221-10"><a href="plots.html#cb221-10"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of Accidents&quot;</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb221-11"><a href="plots.html#cb221-11"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">30000</span>, <span class="dv">2000</span>)) <span class="op">+</span><span class="st">     </span><span class="co"># set y axis to go from 0 to 30,000</span></span>
<span id="cb221-12"><a href="plots.html#cb221-12"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>Police_Force), <span class="dt">size=</span><span class="dv">3</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st">   </span><span class="co"># amend hjust and vjust to change position</span></span>
<span id="cb221-13"><a href="plots.html#cb221-13"></a><span class="st">  </span>theme_dft <span class="co">#here we specify our custom theme</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-203-1.png" width="672" /></p>
<p>The police forces are labelled with numbers, but the chart shows that police force 1 (Metropolitan Police) has the highest number of road accidents in 2017.</p>
</div>
<div id="horizontal-bar-chart" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Horizontal bar chart</h3>
<p>The scatter plot showing the number of accidents by police force could also be shown in a horizontal bar chart.</p>
<p>Use <strong>geom_col</strong> plus <strong>coord_flip</strong> to create a horizontal bar chart.</p>
<p>For the horizontal bar chart, bars will be shown in descending order, with the police force with the largest value at the top of the chart. This is done by ensuring the data is arranged by the number of accidents (“n”).</p>
<p>As this is categorical data, police force is made a factor, with each police force made a separate level.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="plots.html#cb222-1"></a><span class="co"># Arrange police force data by size</span></span>
<span id="cb222-2"><a href="plots.html#cb222-2"></a>accident_pf &lt;-<span class="st"> </span><span class="kw">arrange</span>(accident_pf, n)</span>
<span id="cb222-3"><a href="plots.html#cb222-3"></a><span class="co"># take a subset for charting purposes</span></span>
<span id="cb222-4"><a href="plots.html#cb222-4"></a>accident_pf_small &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(accident_pf, n <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</span>
<span id="cb222-5"><a href="plots.html#cb222-5"></a><span class="co"># Make police force a factor</span></span>
<span id="cb222-6"><a href="plots.html#cb222-6"></a>accident_pf_small<span class="op">$</span>Police_Force &lt;-<span class="st"> </span></span>
<span id="cb222-7"><a href="plots.html#cb222-7"></a><span class="st">  </span><span class="kw">factor</span>(accident_pf_small<span class="op">$</span>Police_Force, <span class="dt">levels =</span> accident_pf_small<span class="op">$</span>Police_Force)</span>
<span id="cb222-8"><a href="plots.html#cb222-8"></a><span class="co"># use the DfT colours and the DfT theme for the accidents by police force scatter chart</span></span>
<span id="cb222-9"><a href="plots.html#cb222-9"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> accident_pf_small) <span class="op">+</span></span>
<span id="cb222-10"><a href="plots.html#cb222-10"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Police_Force, <span class="dt">y =</span> n, <span class="dt">fill =</span> Police_Force)) <span class="op">+</span></span>
<span id="cb222-11"><a href="plots.html#cb222-11"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st">         </span><span class="co"># make bar chart horizontal</span></span>
<span id="cb222-12"><a href="plots.html#cb222-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Reported Road Accidents by Police Force, 2017&quot;</span>, </span>
<span id="cb222-13"><a href="plots.html#cb222-13"></a>       <span class="dt">x =</span> <span class="st">&quot;Police Force&quot;</span>, </span>
<span id="cb222-14"><a href="plots.html#cb222-14"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of Accidents&quot;</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb222-15"><a href="plots.html#cb222-15"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">50</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># set y axis running from 0 to 500</span></span>
<span id="cb222-16"><a href="plots.html#cb222-16"></a><span class="st">   </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> dft_colour) <span class="op">+</span></span>
<span id="cb222-17"><a href="plots.html#cb222-17"></a><span class="st">  </span>theme_dft <span class="op">+</span><span class="st">  </span><span class="co">#here we specify our custom theme</span></span>
<span id="cb222-18"><a href="plots.html#cb222-18"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="co"># command to remove legends</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-204-1.png" width="672" /></p>
<p>The chart shows that police force 98 (Dumfries and Galloway) recorded the lowest number of accidents in 2017.</p>
</div>
<div id="stacked-bar-chart" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Stacked bar chart</h3>
<p>This example will create a stacked bar chart showing the percentage of road accidents in each accident severity category, for each year.</p>
<p>Creating a <strong>percentage stacked bar</strong> requires using the <strong>geom_bar</strong> command in ggplot2 and setting the position to <strong>fill</strong>.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="plots.html#cb223-1"></a><span class="co"># Make accident year a factor so year on x-axis is labelled individually</span></span>
<span id="cb223-2"><a href="plots.html#cb223-2"></a><span class="co">#(otherwise axis will be continuous)</span></span>
<span id="cb223-3"><a href="plots.html#cb223-3"></a>road_acc_year &lt;-<span class="st"> </span>road_acc</span>
<span id="cb223-4"><a href="plots.html#cb223-4"></a><span class="co"># make year a factor</span></span>
<span id="cb223-5"><a href="plots.html#cb223-5"></a>road_acc_year<span class="op">$</span>accident_year &lt;-<span class="st"> </span><span class="kw">as.factor</span>(road_acc_year<span class="op">$</span>accident_year)</span>
<span id="cb223-6"><a href="plots.html#cb223-6"></a><span class="co"># use the DfT colours and the DfT theme for the accidents by police force scatter chart</span></span>
<span id="cb223-7"><a href="plots.html#cb223-7"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc_year, <span class="kw">aes</span>(<span class="dt">fill =</span> name, <span class="dt">y=</span>total, <span class="dt">x=</span> accident_year)) <span class="op">+</span></span>
<span id="cb223-8"><a href="plots.html#cb223-8"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;fill&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st">  </span><span class="co"># geom bar with position fill makes stacked bar</span></span>
<span id="cb223-9"><a href="plots.html#cb223-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Percentage Accident Severity, by Year&quot;</span>, </span>
<span id="cb223-10"><a href="plots.html#cb223-10"></a>       <span class="dt">x =</span> <span class="st">&quot;Accident Year&quot;</span>, </span>
<span id="cb223-11"><a href="plots.html#cb223-11"></a>       <span class="dt">y =</span> <span class="st">&quot;% Accident Severity&quot;</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb223-12"><a href="plots.html#cb223-12"></a><span class="st">   </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> dft_colour) <span class="op">+</span></span>
<span id="cb223-13"><a href="plots.html#cb223-13"></a><span class="st">  </span>theme_dft </span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-205-1.png" width="672" /></p>
<p>If you want the stacked bar chart to show numbers instead of percentages use <strong>position = “stack”</strong> instead.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="plots.html#cb224-1"></a><span class="co"># use the DfT colours and the DfT theme for the accidents by police force scatter chart</span></span>
<span id="cb224-2"><a href="plots.html#cb224-2"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc_year, <span class="kw">aes</span>(<span class="dt">fill =</span> name, <span class="dt">y=</span>total, <span class="dt">x=</span> accident_year)) <span class="op">+</span></span>
<span id="cb224-3"><a href="plots.html#cb224-3"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;stack&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb224-4"><a href="plots.html#cb224-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Number of accidents by severity, by Year&quot;</span>, </span>
<span id="cb224-5"><a href="plots.html#cb224-5"></a>       <span class="dt">x =</span> <span class="st">&quot;Accident Year&quot;</span>, </span>
<span id="cb224-6"><a href="plots.html#cb224-6"></a>       <span class="dt">y =</span> <span class="st">&quot;% Accident Severity&quot;</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb224-7"><a href="plots.html#cb224-7"></a><span class="st">   </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> dft_colour) <span class="op">+</span></span>
<span id="cb224-8"><a href="plots.html#cb224-8"></a><span class="st">  </span>theme_dft </span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-206-1.png" width="672" /></p>
</div>
</div>
<div id="interactive-charts-with-plotly" class="section level2">
<h2><span class="header-section-number">7.6</span> Interactive charts with {plotly}</h2>
<p>{plotly} is a graphing library which makes interactive html graphs. It uses the open source JavaScript graphing library plotly.js. It is great for building dashboards or allowing the user to interact with the data themselves.</p>
<p>{plotly} is not necessarily good for publications as the charts are html but can be useful for exploratory analysis or QA notes. It allows you to zoom into certain parts of the chart and toggle between different categories.</p>
<p>It can be used in two ways - either with {ggplot2} (easier option) or using the plot_ly() wrapper directly which gives you more control.</p>
<div id="plotly-with-ggplot2" class="section level3">
<h3><span class="header-section-number">7.6.1</span> {plotly} with {ggplot2}</h3>
<p>Taking our previous accidents by severity plot, we can simply assign this to an object and use the ggplotly() function to make it interactive.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="plots.html#cb225-1"></a><span class="kw">library</span>(plotly)</span>
<span id="cb225-2"><a href="plots.html#cb225-2"></a>road_acc_chart &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> road_acc) <span class="op">+</span></span>
<span id="cb225-3"><a href="plots.html#cb225-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> accident_year, <span class="dt">y =</span> total, <span class="dt">colour =</span> name), <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb225-4"><a href="plots.html#cb225-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Accidents by severity, 2005 to 2017&quot;</span>, </span>
<span id="cb225-5"><a href="plots.html#cb225-5"></a>       <span class="dt">x =</span> <span class="st">&quot;Accident Year&quot;</span>, </span>
<span id="cb225-6"><a href="plots.html#cb225-6"></a>       <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)<span class="op">+</span></span>
<span id="cb225-7"><a href="plots.html#cb225-7"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">2005</span>, <span class="dv">2017</span>, <span class="dv">2</span>))<span class="op">+</span></span>
<span id="cb225-8"><a href="plots.html#cb225-8"></a><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> dft_colour) <span class="op">+</span><span class="st"> </span></span>
<span id="cb225-9"><a href="plots.html#cb225-9"></a><span class="st">  </span>theme_dft </span>
<span id="cb225-10"><a href="plots.html#cb225-10"></a>plotly<span class="op">::</span><span class="kw">ggplotly</span>(road_acc_chart)</span>
<span id="cb225-11"><a href="plots.html#cb225-11"></a><span class="co">#&gt; Warning: plotly.js does not (yet) support horizontal legend items </span></span>
<span id="cb225-12"><a href="plots.html#cb225-12"></a><span class="co">#&gt; You can track progress here: </span></span>
<span id="cb225-13"><a href="plots.html#cb225-13"></a><span class="co">#&gt; https://github.com/plotly/plotly.js/issues/53</span></span></code></pre></div>
<div id="htmlwidget-120ddebd1185086e1069" style="width:672px;height:576px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-120ddebd1185086e1069">{"x":{"data":[{"x":[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],"y":[2913,2926,2714,2341,2057,1731,1797,1637,1608,1658,1618,1695,1676],"text":["accident_year: 2005<br />total:   2913<br />name: Fatal","accident_year: 2006<br />total:   2926<br />name: Fatal","accident_year: 2007<br />total:   2714<br />name: Fatal","accident_year: 2008<br />total:   2341<br />name: Fatal","accident_year: 2009<br />total:   2057<br />name: Fatal","accident_year: 2010<br />total:   1731<br />name: Fatal","accident_year: 2011<br />total:   1797<br />name: Fatal","accident_year: 2012<br />total:   1637<br />name: Fatal","accident_year: 2013<br />total:   1608<br />name: Fatal","accident_year: 2014<br />total:   1658<br />name: Fatal","accident_year: 2015<br />total:   1618<br />name: Fatal","accident_year: 2016<br />total:   1695<br />name: Fatal","accident_year: 2017<br />total:   1676<br />name: Fatal"],"type":"scatter","mode":"lines","line":{"width":5.66929133858268,"color":"rgba(0,104,83,1)","dash":"solid"},"hoveron":"points","name":"Fatal","legendgroup":"Fatal","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],"y":[25029,24946,24322,23121,21997,20440,20986,20901,19624,20676,20033,21725,22534],"text":["accident_year: 2005<br />total:  25029<br />name: Serious","accident_year: 2006<br />total:  24946<br />name: Serious","accident_year: 2007<br />total:  24322<br />name: Serious","accident_year: 2008<br />total:  23121<br />name: Serious","accident_year: 2009<br />total:  21997<br />name: Serious","accident_year: 2010<br />total:  20440<br />name: Serious","accident_year: 2011<br />total:  20986<br />name: Serious","accident_year: 2012<br />total:  20901<br />name: Serious","accident_year: 2013<br />total:  19624<br />name: Serious","accident_year: 2014<br />total:  20676<br />name: Serious","accident_year: 2015<br />total:  20033<br />name: Serious","accident_year: 2016<br />total:  21725<br />name: Serious","accident_year: 2017<br />total:  22534<br />name: Serious"],"type":"scatter","mode":"lines","line":{"width":5.66929133858268,"color":"rgba(102,164,152,1)","dash":"solid"},"hoveron":"points","name":"Serious","legendgroup":"Serious","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],"y":[170793,161289,155079,145129,139500,132243,128691,123033,117428,123988,118435,113201,105772],"text":["accident_year: 2005<br />total: 170793<br />name: Slight","accident_year: 2006<br />total: 161289<br />name: Slight","accident_year: 2007<br />total: 155079<br />name: Slight","accident_year: 2008<br />total: 145129<br />name: Slight","accident_year: 2009<br />total: 139500<br />name: Slight","accident_year: 2010<br />total: 132243<br />name: Slight","accident_year: 2011<br />total: 128691<br />name: Slight","accident_year: 2012<br />total: 123033<br />name: Slight","accident_year: 2013<br />total: 117428<br />name: Slight","accident_year: 2014<br />total: 123988<br />name: Slight","accident_year: 2015<br />total: 118435<br />name: Slight","accident_year: 2016<br />total: 113201<br />name: Slight","accident_year: 2017<br />total: 105772<br />name: Slight"],"type":"scatter","mode":"lines","line":{"width":5.66929133858268,"color":"rgba(210,95,21,1)","dash":"solid"},"hoveron":"points","name":"Slight","legendgroup":"Slight","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":45.7772242977722,"r":7.30593607305936,"b":42.7286564272866,"l":50.8094645080947},"paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Accidents by severity, 2005 to 2017","font":{"color":"rgba(0,0,0,1)","family":"sans","size":21.2536322125363},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2004.4,2017.6],"tickmode":"array","ticktext":["2005","2007","2009","2011","2013","2015","2017"],"tickvals":[2005,2007,2009,2011,2013,2015,2017],"categoryorder":"array","categoryarray":["2005","2007","2009","2011","2013","2015","2017"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(0,0,0,1)","family":"sans","size":13.2835201328352},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"Accident Year","font":{"color":"rgba(0,0,0,1)","family":"sans","size":17.2685761726858}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-6851.25,179252.25],"tickmode":"array","ticktext":["0","50000","100000","150000"],"tickvals":[0,50000,100000,150000],"categoryorder":"array","categoryarray":["0","50000","100000","150000"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(0,0,0,1)","family":"sans","size":13.2835201328352},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":null,"family":null,"size":0}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"sans","size":11.9551681195517},"y":1},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"e4628617278":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"e4628617278","visdat":{"e4628617278":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Since we set our legend to be horizontal in our DfT theme, we get a warning message as plotly.js does not support horizontal legend items yet.</p>
</div>
<div id="plot_ly" class="section level3">
<h3><span class="header-section-number">7.6.2</span> plot_ly()</h3>
<p>Using plot_ly() is similar to {ggplot2} in some ways as we build the plot in layers but we use the pipe operator rather than a plus sign, and the ~ sign before the variables in our data:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="plots.html#cb226-1"></a>plotly<span class="op">::</span><span class="kw">plot_ly</span>(road_acc, <span class="dt">x =</span> <span class="op">~</span>accident_year, <span class="dt">y =</span> <span class="op">~</span>total) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># specify the data and x and y axes</span></span>
<span id="cb226-2"><a href="plots.html#cb226-2"></a><span class="st">  </span>plotly<span class="op">::</span><span class="kw">add_lines</span>(<span class="dt">color =</span> <span class="op">~</span>name, <span class="dt">colors =</span> dft_colour[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># colour lines by severity</span></span>
<span id="cb226-3"><a href="plots.html#cb226-3"></a><span class="st">  </span>plotly<span class="op">::</span><span class="kw">layout</span>(<span class="dt">title =</span> <span class="st">&quot;Accidents by severity, 2005 to 2017&quot;</span>,</span>
<span id="cb226-4"><a href="plots.html#cb226-4"></a>         <span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Accident Year&quot;</span>),</span>
<span id="cb226-5"><a href="plots.html#cb226-5"></a>         <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-a4613e9a28a8b5fbcd3e" style="width:672px;height:576px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-a4613e9a28a8b5fbcd3e">{"x":{"visdat":{"e46603ae5e8":["function () ","plotlyVisDat"]},"cur_data":"e46603ae5e8","attrs":{"e46603ae5e8":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","color":{},"colors":["#006853","#66A498","#D25F15"],"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Accidents by severity, 2005 to 2017","xaxis":{"domain":[0,1],"automargin":true,"title":"Accident Year"},"yaxis":{"domain":[0,1],"automargin":true,"title":""},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],"y":[2913,2926,2714,2341,2057,1731,1797,1637,1608,1658,1618,1695,1676],"type":"scatter","mode":"lines","name":"Fatal","marker":{"color":"rgba(0,104,83,1)","line":{"color":"rgba(0,104,83,1)"}},"textfont":{"color":"rgba(0,104,83,1)"},"error_y":{"color":"rgba(0,104,83,1)"},"error_x":{"color":"rgba(0,104,83,1)"},"line":{"color":"rgba(0,104,83,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],"y":[25029,24946,24322,23121,21997,20440,20986,20901,19624,20676,20033,21725,22534],"type":"scatter","mode":"lines","name":"Serious","marker":{"color":"rgba(102,164,152,1)","line":{"color":"rgba(102,164,152,1)"}},"textfont":{"color":"rgba(102,164,152,1)"},"error_y":{"color":"rgba(102,164,152,1)"},"error_x":{"color":"rgba(102,164,152,1)"},"line":{"color":"rgba(102,164,152,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],"y":[170793,161289,155079,145129,139500,132243,128691,123033,117428,123988,118435,113201,105772],"type":"scatter","mode":"lines","name":"Slight","marker":{"color":"rgba(210,95,21,1)","line":{"color":"rgba(210,95,21,1)"}},"textfont":{"color":"rgba(210,95,21,1)"},"error_y":{"color":"rgba(210,95,21,1)"},"error_x":{"color":"rgba(210,95,21,1)"},"line":{"color":"rgba(210,95,21,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>You can find more information about using {plotly} in R from the following websites:</p>
<ul>
<li><p>Graphing library with example code: <a href="https://plot.ly/r/">https://plot.ly/r/</a></p></li>
<li><p>Cheat sheet: <a href="https://images.plot.ly/plotly-documentation/images/r_cheat_sheet.pdf">https://images.plot.ly/plotly-documentation/images/r_cheat_sheet.pdf</a></p></li>
<li><p>E-book: <a href="https://plotly-r.com/index.html">https://plotly-r.com/index.html</a></p></li>
</ul>
</div>
</div>
<div id="mapping-in-r" class="section level2">
<h2><span class="header-section-number">7.7</span> Mapping in R</h2>
<p>There are a wide range of packages you can use to produce maps in R. For static choropleth maps, we’re going to focus on using {ggplot2} which we are now familiar with.</p>
<div id="mapping-with-ggplot2" class="section level3">
<h3><span class="header-section-number">7.7.1</span> Mapping with {ggplot2}</h3>
<p>To complete.</p>
</div>
<div id="mapping-with-leaflet" class="section level3">
<h3><span class="header-section-number">7.7.2</span> Mapping with {leaflet}</h3>
<p>The {leaflet} package can be used to create interactive maps in R. Similar to {ggplot2}, you start with a base map and then add layers (i.e. features). We’re going to map some search and rescue helicopter data, using the longitude and latitude.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="plots.html#cb227-1"></a><span class="kw">library</span>(leaflet)</span>
<span id="cb227-2"><a href="plots.html#cb227-2"></a>sarh &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;data/SARH_spatial.csv&quot;</span>)</span>
<span id="cb227-3"><a href="plots.html#cb227-3"></a><span class="co">#&gt; </span></span>
<span id="cb227-4"><a href="plots.html#cb227-4"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb227-5"><a href="plots.html#cb227-5"></a><span class="co">#&gt; cols(</span></span>
<span id="cb227-6"><a href="plots.html#cb227-6"></a><span class="co">#&gt;   Base = col_character(),</span></span>
<span id="cb227-7"><a href="plots.html#cb227-7"></a><span class="co">#&gt;   Unique_ID = col_character(),</span></span>
<span id="cb227-8"><a href="plots.html#cb227-8"></a><span class="co">#&gt;   Cat = col_character(),</span></span>
<span id="cb227-9"><a href="plots.html#cb227-9"></a><span class="co">#&gt;   latitude_new = col_double(),</span></span>
<span id="cb227-10"><a href="plots.html#cb227-10"></a><span class="co">#&gt;   longitude_new = col_double(),</span></span>
<span id="cb227-11"><a href="plots.html#cb227-11"></a><span class="co">#&gt;   Place = col_character(),</span></span>
<span id="cb227-12"><a href="plots.html#cb227-12"></a><span class="co">#&gt;   Domain = col_character()</span></span>
<span id="cb227-13"><a href="plots.html#cb227-13"></a><span class="co">#&gt; )</span></span>
<span id="cb227-14"><a href="plots.html#cb227-14"></a><span class="kw">head</span>(sarh)</span></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
Base
</th>
<th style="text-align:left;">
Unique_ID
</th>
<th style="text-align:left;">
Cat
</th>
<th style="text-align:right;">
latitude_new
</th>
<th style="text-align:right;">
longitude_new
</th>
<th style="text-align:left;">
Place
</th>
<th style="text-align:left;">
Domain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Sumburgh
</td>
<td style="text-align:left;">
Sumb6559171
</td>
<td style="text-align:left;">
Rescue/Recovery
</td>
<td style="text-align:right;">
61.10333
</td>
<td style="text-align:right;">
1.073333
</td>
<td style="text-align:left;">
Cormorant Alpha
</td>
<td style="text-align:left;">
Maritime
</td>
</tr>
<tr>
<td style="text-align:left;">
Caernarfon
</td>
<td style="text-align:left;">
Caer6580171
</td>
<td style="text-align:left;">
Support
</td>
<td style="text-align:right;">
51.88602
</td>
<td style="text-align:right;">
-5.307241
</td>
<td style="text-align:left;">
Whitesands Bay
</td>
<td style="text-align:left;">
Coastal
</td>
</tr>
<tr>
<td style="text-align:left;">
Humberside
</td>
<td style="text-align:left;">
Humb6587171
</td>
<td style="text-align:left;">
Rescue/Recovery
</td>
<td style="text-align:right;">
53.39779
</td>
<td style="text-align:right;">
-1.903712
</td>
<td style="text-align:left;">
Kinder Scout
</td>
<td style="text-align:left;">
Land
</td>
</tr>
<tr>
<td style="text-align:left;">
Prestwick
</td>
<td style="text-align:left;">
Pres6613171
</td>
<td style="text-align:left;">
Rescue/Recovery
</td>
<td style="text-align:right;">
56.33115
</td>
<td style="text-align:right;">
-4.618574
</td>
<td style="text-align:left;">
Beinn A Chroin
</td>
<td style="text-align:left;">
Land
</td>
</tr>
<tr>
<td style="text-align:left;">
Inverness
</td>
<td style="text-align:left;">
Inve6614171
</td>
<td style="text-align:left;">
Rescue/Recovery
</td>
<td style="text-align:right;">
56.80076
</td>
<td style="text-align:right;">
-5.034575
</td>
<td style="text-align:left;">
Ben Nevis
</td>
<td style="text-align:left;">
Land
</td>
</tr>
<tr>
<td style="text-align:left;">
Newquay
</td>
<td style="text-align:left;">
Newq6617171
</td>
<td style="text-align:left;">
Search only
</td>
<td style="text-align:right;">
50.04000
</td>
<td style="text-align:right;">
-5.636667
</td>
<td style="text-align:left;">
Porthcurno
</td>
<td style="text-align:left;">
Maritime
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="plots.html#cb228-1"></a><span class="co">#plot the interactive map using leaflet</span></span>
<span id="cb228-2"><a href="plots.html#cb228-2"></a>leaflet<span class="op">::</span><span class="kw">leaflet</span>(<span class="dt">data =</span> sarh) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb228-3"><a href="plots.html#cb228-3"></a><span class="st">  </span>leaflet<span class="op">::</span><span class="kw">addProviderTiles</span>(<span class="dt">provider =</span> providers<span class="op">$</span>Esri.NatGeoWorldMap) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">#select the type of map you want to plot</span></span>
<span id="cb228-4"><a href="plots.html#cb228-4"></a><span class="st">  </span>leaflet<span class="op">::</span><span class="kw">addMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>longitude_new, </span>
<span id="cb228-5"><a href="plots.html#cb228-5"></a>                      <span class="dt">lat =</span> <span class="op">~</span><span class="st"> </span>latitude_new, </span>
<span id="cb228-6"><a href="plots.html#cb228-6"></a>                      <span class="dt">popup =</span> <span class="op">~</span><span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlEscape</span>(Base), <span class="co"># what appears when you click on a data point</span></span>
<span id="cb228-7"><a href="plots.html#cb228-7"></a>                      <span class="dt">label =</span> <span class="op">~</span><span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlEscape</span>(Domain) <span class="co"># what appears when you hover over a data point</span></span>
<span id="cb228-8"><a href="plots.html#cb228-8"></a>  )</span></code></pre></div>
<div id="htmlwidget-b35acf88a55969b8abe3" style="width:672px;height:576px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-b35acf88a55969b8abe3">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.NatGeoWorldMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addMarkers","args":[[61.1033333333333,51.886015,53.39779,56.331152,56.800758,50.04,51.45365,50.711125,54.575,57.4231666666667,51.799501,52.586561,51.16483,57.8333333333333,56.462968,56.805099,53.330636,56.515513,52.852372,50.547397,56.849041,60.9083333333333,54.893463,52.403546,53.8333333333333,50.735242,50.402114,49.912498,57.55563,50.410538,52.2073333333333,61.035,50.735242,54.454098,50.5821666666667,57.798884,50.765305,60.327256,54.4873333333333,51.2333333333333,49.9063333333333,61.7333333333333,57.5933333333333,50.216471,53.25234,49.912498,49.9616666666667,51.5858333333333,56.213799,57.027449,53.325235,51.60161,54.65043,51.39431,50.712041,59.254395,54.472066,54.595,51.811757,59.367065,50.4916666666667,56.235687,50.100836,51.075085,53.067777,50.626493,57.480292,50.710226,59.250456,56.235687,49.3525,50.711134,54.235332,57.137513,53.072398,53.020986,55.243419,59.248879,49.913343,51.22967,56.230154,56.517254,49.912446,49.913343,55.938184,50.264682,59.57,53.011309,51.4861666666667,60.353108,52.848703,53.001038,59.349956,60.353984,52.363585,59.7433333333333,50.746626,56.800718,54.539303,52.839442,60.805,50.697603,53.383375,51.397273,56.312653,49.913343,50.8248333333333,50.711125,58.9855,53.8776666666667,50.591828,59.5183333333333,59.25,50.739231,50.290231,49.912498,52.4833333333333,50.73403,59.5885,50.736448,50.736448,53.588081,55.542021,53.076125,50.621169,51.288194,57.993954,59.5885,53.891381,50.223794,50.043899,49.913549,50.3016666666667,50.006533,50.710226,52.979443,53.541895,58.662711,50.616769,55.333695,50.7155,53.0183333333333,59.4028333333333,53.26,51.4731666666667,57.725,51.8741666666667,56.1236666666667,54.4381666666667,52.809,57.8376666666667,50.7371666666667,56.569819,53.1211666666667,51.4418333333333,56.67347,57.639381,52.891176,49.435,50.32,50.67,53.5383333333333,50.0966666666667,50.0966666666667,56.24,57.73537,54.447046,57.895382,56.849041,59.5733333333333,51.378809,58.7666666666667,55.5901666666667,57.703953,50.710226,54.672456,50.481427,49.930384,56.75,50.725,57.417765,60.7333333333333,53.3883333333333,50.711125,59.875,50.657463,54.7563333333333,57.974281,49.91324,50.710226,58.3315,55.354281,58.346371,50.912007,53.067777,53.067777,53.077524,50.623547,50.094145,54.527648,55.915562,54.527648,50.710226,53.067777,51.3826666666667,56.213799,50.075675,57.007361,54.473865],[1.07333333333333,-5.3072415,-1.9037115,-4.6185738,-5.0345747,-5.63666666666667,0.81529027,-1.2988755,-5.93083333333333,-5.25,-2.445147,-4.088587,-4.6659543,-8.05,-2.9541999,-5.003795,-3.8379289,-5.9126421,-4.0033043,-4.9796494,-5.0450465,-2.16333333333333,-1.3622953,-4.0652278,-3.88333333333333,-1.668363,-3.5139878,-6.291765,-6.22611,-5.1216725,-4.32366666666667,1.705,-1.668363,-3.2122852,-1.06183333333333,-3.8439383,0.29439376,-1.6668376,-0.619333333333333,-3.85283333333333,-6.27366666666667,1.155,-1.76166666666667,-3.7926494,-4.6126107,-6.291765,-3.91933333333333,-4.67166666666667,-4.8057287,-2.4068696,-3.7791359,-3.8394612,-3.5684073,-3.4933362,-1.3016946,-2.5470855,-0.61891283,0.431666666666667,-3.8567121,-2.4363027,-0.43,-4.8702732,-5.4175696,1.1963064,-4.0774737,-2.3081466,-4.3616475,-1.298889,-2.6241682,-4.8702732,-2.32533333333333,-1.3002917,-0.44270768,-3.6588847,-4.0702322,-4.0796972,-4.8643807,-2.576802,-6.2932337,-3.9291465,-4.876314,-5.9144484,-6.2931539,-6.2932337,-4.9074732,-5.0587897,1.6785,-4.0151321,-0.8035,-1.2008459,-4.4828425,-4.1398424,-2.9513128,-1.1972,-3.4949692,1.67166666666667,0.18999653,-5.0362097,-3.3152798,-4.4956782,1.45,-1.2934134,-1.8691659,-3.5423076,-6.409623,-6.2932337,-0.258833333333333,-1.2988755,-2.9525,1.89766666666667,-1.9872328,-1.63833333333333,-2.57066666666667,0.24776319,-5.2443737,-6.291765,2.05333333333333,0.23759374,1.05483333333333,0.20511165,0.20511165,0.039535017,-5.1159577,-1.5626071,-2.2798398,-2.7398878,-7.0975821,1.05483333333333,-0.14812658,-5.396911,-5.6901347,-6.2876781,-1.31666666666667,-5.1582143,-1.298889,0.75261592,0.1610761,-4.4583291,-2.2359962,-1.5428338,-0.9985,1.79666666666667,-2.00333333333333,0.916666666666667,0.994333333333333,-5.72416666666667,-3.12833333333333,-4.81966666666667,-3.29033333333333,-3.90233333333333,-5.595,0.2575,-5.175614,-3.9695,-3.604,-5.0569796,-4.0502852,-3.1905112,-2.60283333333333,-4.685,-1.45816666666667,-0.2245,-5.27833333333333,-5.27833333333333,-4.74916666666667,-3.6273829,-3.1041236,-6.3639329,-5.0450465,1.055,-3.5100745,-7.65,-2.738,-7.2146621,-1.298889,-3.3025225,-4.0338273,-6.2947501,-7.05,-0.959333333333333,-5.691916,-2.48333333333333,2.005,-1.2988755,-6.53333333333333,-1.9433601,-3.92583333333333,-4.6460662,-6.2960114,-1.298889,-5.5795,-2.4778499,-5.1575743,-1.5518955,-4.0774737,-4.0774737,-3.9256605,-4.7737752,-5.3695452,-3.6100551,-4.9137816,-3.6100551,-1.298889,-4.0774737,-3.365,-4.8057287,-5.7093525,-7.510735,-3.2128698],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Sumburgh","Caernarfon","Humberside","Prestwick","Inverness","Newquay","Lydd","Lee on Solent","Prestwick","Inverness","St Athan","Caernarfon","Newquay","Stornoway","Inverness","Inverness","Caernarfon","Prestwick","Caernarfon","Newquay","Prestwick","Sumburgh","Humberside","St Athan","Caernarfon","Lee on Solent","Newquay","Newquay","Stornoway","Newquay","St Athan","Sumburgh","Lee on Solent","Prestwick","Lee on Solent","Inverness","Lydd","Sumburgh","Humberside","St Athan","Newquay","Sumburgh","Inverness","Newquay","Caernarfon","Newquay","Newquay","St Athan","Prestwick","Inverness","Caernarfon","St Athan","Prestwick","St Athan","Lee on Solent","Sumburgh","Humberside","Humberside","St Athan","Sumburgh","Lee on Solent","Prestwick","Newquay","Lydd","Caernarfon","Lee on Solent","Inverness","Lee on Solent","Sumburgh","Inverness","Lydd","Lee on Solent","Humberside","Inverness","Caernarfon","Caernarfon","Prestwick","Sumburgh","Newquay","St Athan","Prestwick","Prestwick","Newquay","Newquay","Prestwick","Newquay","Sumburgh","Caernarfon","Lee on Solent","Sumburgh","Caernarfon","Caernarfon","Sumburgh","Sumburgh","Caernarfon","Sumburgh","Lydd","Inverness","Prestwick","Caernarfon","Sumburgh","Lee on Solent","Humberside","St Athan","Prestwick","Lee on Solent","Lee on Solent","Lee on Solent","Sumburgh","Humberside","Lee on Solent","Sumburgh","Inverness","Lydd","Newquay","Newquay","Humberside","Lydd","Sumburgh","Lydd","Lydd","Humberside","Prestwick","Humberside","Lee on Solent","St Athan","Stornoway","Sumburgh","Humberside","Newquay","Newquay","Newquay","Lee on Solent","Newquay","Lee on Solent","Humberside","Humberside","Stornoway","Lee on Solent","Prestwick","Lee on Solent","Humberside","Sumburgh","Humberside","Lydd","Stornoway","St Athan","Prestwick","Humberside","Caernarfon","Stornoway","Lydd","Prestwick","Caernarfon","St Athan","Inverness","Inverness","Caernarfon","Newquay","Newquay","Lee on Solent","Humberside","Newquay","Prestwick","Prestwick","Inverness","Prestwick","Stornoway","Prestwick","Sumburgh","St Athan","Stornoway","Prestwick","Stornoway","Lee on Solent","Prestwick","Newquay","Newquay","Stornoway","Lee on Solent","Inverness","Sumburgh","Humberside","Lee on Solent","Stornoway","Lee on Solent","Prestwick","Inverness","Newquay","Lee on Solent","Stornoway","Prestwick","Inverness","Lee on Solent","Caernarfon","Caernarfon","Caernarfon","Newquay","Newquay","Prestwick","Inverness","Prestwick","Lee on Solent","Caernarfon","St Athan","Prestwick","Newquay","Stornoway","Prestwick"],null,null,null,["Maritime","Coastal","Land","Land","Land","Maritime","Coastal","Land","Land","Land","Land","Land","Land","Maritime","Coastal","Land","Land","Land","Land","Coastal","Land","Maritime","Coastal","Land","Maritime","Coastal","Coastal","Land","Land","Coastal","Coastal","Maritime","Coastal","Land","Maritime","Coastal","Coastal","Land","Coastal","Coastal","Land","Maritime","Maritime","Coastal","Coastal","Land","Maritime","Maritime","Land","Land","Coastal","Coastal","Aero","Coastal","Aero","Land","Land","Maritime","Land","Land","Maritime","Land","Coastal","Maritime","Land","Coastal","Coastal","Land","Land","Land","Land","Land","Land","Land","Land","Land","Coastal","Land","Land","Coastal","Land","Land","Land","Land","Maritime","Land","Maritime","Land","Aero","Land","Coastal","Land","Land","Land","Land","Maritime","Coastal","Land","Land","Coastal","Maritime","Land","Land","Coastal","Coastal","Land","Land","Land","Land","Maritime","Coastal","Land","Land","Coastal","Coastal","Land","Maritime","Coastal","Maritime","Coastal","Coastal","Maritime","Land","Land","Coastal","Land","Coastal","Maritime","Coastal","Coastal","Coastal","Land","Maritime","Coastal","Land","Coastal","Maritime","Maritime","Coastal","Coastal","Maritime","Maritime","Maritime","Maritime","Maritime","Coastal","Land","Maritime","Land","Land","Coastal","Coastal","Land","Land","Coastal","Land","Coastal","Land","Land","Coastal","Land","Land","Land","Aero","Land","Maritime","Land","Land","Land","Maritime","Maritime","Maritime","Land","Land","Land","Land","Land","Land","Coastal","Maritime","Land","Maritime","Maritime","Land","Maritime","Maritime","Maritime","Land","Land","Land","Maritime","Land","Land","Land","Land","Land","Land","Coastal","Coastal","Coastal","Coastal","Coastal","Land","Land","Maritime","Land","Coastal","Coastal","Land"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[49.3525,61.7333333333333],"lng":[-8.05,2.05333333333333]}},"evals":[],"jsHooks":[]}</script>
<p>If you want to save this as a static map, you could simply export is an image. More information on using {leaflet} in R can be found here: <a href="https://rstudio.github.io/leaflet/">https://rstudio.github.io/leaflet/</a></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="factors.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="RAP.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
