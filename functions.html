<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Functions | DfT R Cookbook</title>
  <meta name="description" content="Guidance and code examples for R usage for DfT and beyond" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Functions | DfT R Cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Guidance and code examples for R usage for DfT and beyond" />
  <meta name="github-repo" content="departmentfortransport/R-cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Functions | DfT R Cookbook" />
  
  <meta name="twitter:description" content="Guidance and code examples for R usage for DfT and beyond" />
  

<meta name="author" content="Isi Avbulimen, Hannah Bougdah, Tamsin Forbes, Jack Marks, Tim Taylor" />


<meta name="date" content="2021-03-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatial.html"/>

<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.17/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="why-do-we-need-another-book.html"><a href="why-do-we-need-another-book.html"><i class="fa fa-check"></i><b>1</b> Why do we need <em>another</em> book?</a><ul>
<li class="chapter" data-level="1.1" data-path="why-do-we-need-another-book.html"><a href="why-do-we-need-another-book.html#coding-standards"><i class="fa fa-check"></i><b>1.1</b> Coding standards</a></li>
<li class="chapter" data-level="1.2" data-path="why-do-we-need-another-book.html"><a href="why-do-we-need-another-book.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="why-do-we-need-another-book.html"><a href="why-do-we-need-another-book.html#work-in-progress"><i class="fa fa-check"></i><b>1.3</b> Work in progress</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> The basics</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#r-family"><i class="fa fa-check"></i><b>2.1</b> R family</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#dft-rrstudio---subject-to-change"><i class="fa fa-check"></i><b>2.2</b> DfT R/RStudio - subject to change</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#rstudio-ide"><i class="fa fa-check"></i><b>2.3</b> RStudio IDE</a><ul>
<li class="chapter" data-level="2.3.1" data-path="basics.html"><a href="basics.html#left-bottom-left-if-you-have-scripts-open"><i class="fa fa-check"></i><b>2.3.1</b> Left (bottom left if you have scripts open)</a></li>
<li class="chapter" data-level="2.3.2" data-path="basics.html"><a href="basics.html#top-right-environment-and-other-tabs"><i class="fa fa-check"></i><b>2.3.2</b> Top right; <strong>Environment</strong>, and other tabs</a></li>
<li class="chapter" data-level="2.3.3" data-path="basics.html"><a href="basics.html#bottom-right"><i class="fa fa-check"></i><b>2.3.3</b> Bottom right</a></li>
<li class="chapter" data-level="2.3.4" data-path="basics.html"><a href="basics.html#other-handy-buttons-in-rstudio-ide"><i class="fa fa-check"></i><b>2.3.4</b> Other handy buttons in RStudio IDE</a></li>
<li class="chapter" data-level="2.3.5" data-path="basics.html"><a href="basics.html#rstudio-menu-bar-a-few-pointers"><i class="fa fa-check"></i><b>2.3.5</b> RStudio menu bar a few pointers</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#projects"><i class="fa fa-check"></i><b>2.4</b> Projects</a><ul>
<li class="chapter" data-level="2.4.1" data-path="basics.html"><a href="basics.html#folders"><i class="fa fa-check"></i><b>2.4.1</b> Folders</a></li>
<li class="chapter" data-level="2.4.2" data-path="basics.html"><a href="basics.html#sessioninfo"><i class="fa fa-check"></i><b>2.4.2</b> sessionInfo()</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#r-memory"><i class="fa fa-check"></i><b>2.5</b> R memory</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#a-note-on-rounding"><i class="fa fa-check"></i><b>2.6</b> A note on rounding</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#assignment-operators---vs"><i class="fa fa-check"></i><b>2.7</b> Assignment operators <code>&lt;-</code> vs <code>=</code></a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#arithmetic-operators"><i class="fa fa-check"></i><b>2.8</b> Arithmetic operators</a></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#relational-operators"><i class="fa fa-check"></i><b>2.9</b> Relational operators</a></li>
<li class="chapter" data-level="2.10" data-path="basics.html"><a href="basics.html#logical-operators"><i class="fa fa-check"></i><b>2.10</b> Logical operators</a></li>
<li class="chapter" data-level="2.11" data-path="basics.html"><a href="basics.html#vectors"><i class="fa fa-check"></i><b>2.11</b> Vectors</a><ul>
<li class="chapter" data-level="2.11.1" data-path="basics.html"><a href="basics.html#vector-types"><i class="fa fa-check"></i><b>2.11.1</b> Types</a></li>
<li class="chapter" data-level="2.11.2" data-path="basics.html"><a href="basics.html#conversion-between-atomic-vector-types"><i class="fa fa-check"></i><b>2.11.2</b> Conversion between atomic vector types</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>3</b> Data Importing/Exporting and interaction with other programmes</a><ul>
<li class="chapter" data-level="3.1" data-path="data-import.html"><a href="data-import.html#libraries"><i class="fa fa-check"></i><b>3.1</b> Libraries</a></li>
<li class="chapter" data-level="3.2" data-path="data-import.html"><a href="data-import.html#star-functions"><i class="fa fa-check"></i><b>3.2</b> Star functions</a></li>
<li class="chapter" data-level="3.3" data-path="data-import.html"><a href="data-import.html#navigating-folders"><i class="fa fa-check"></i><b>3.3</b> Navigating folders</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-import.html"><a href="data-import.html#up"><i class="fa fa-check"></i><b>3.3.1</b> Up</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-import.html"><a href="data-import.html#rds"><i class="fa fa-check"></i><b>3.4</b> .rds</a></li>
<li class="chapter" data-level="3.5" data-path="data-import.html"><a href="data-import.html#csv"><i class="fa fa-check"></i><b>3.5</b> .csv</a></li>
<li class="chapter" data-level="3.6" data-path="data-import.html"><a href="data-import.html#xlsx-and-.xls"><i class="fa fa-check"></i><b>3.6</b> .xlsx and .xls</a><ul>
<li class="chapter" data-level="3.6.1" data-path="data-import.html"><a href="data-import.html#single-worksheet---single-workbook"><i class="fa fa-check"></i><b>3.6.1</b> Single worksheet - single workbook</a></li>
<li class="chapter" data-level="3.6.2" data-path="data-import.html"><a href="data-import.html#single-worksheet---many-workbooks"><i class="fa fa-check"></i><b>3.6.2</b> Single worksheet - many workbooks</a></li>
<li class="chapter" data-level="3.6.3" data-path="data-import.html"><a href="data-import.html#many-worksheets---single-workbook"><i class="fa fa-check"></i><b>3.6.3</b> Many worksheets - single workbook</a></li>
<li class="chapter" data-level="3.6.4" data-path="data-import.html"><a href="data-import.html#many-worksheets---many-workbooks"><i class="fa fa-check"></i><b>3.6.4</b> Many worksheets - many workbooks</a></li>
<li class="chapter" data-level="3.6.5" data-path="data-import.html"><a href="data-import.html#non-rectangular-data---single-worksheet---single-workbook"><i class="fa fa-check"></i><b>3.6.5</b> Non-rectangular data - single worksheet - single workbook</a></li>
<li class="chapter" data-level="3.6.6" data-path="data-import.html"><a href="data-import.html#non-rectangular-data---single-worksheet---many-workbooks"><i class="fa fa-check"></i><b>3.6.6</b> Non-rectangular data - single worksheet - many workbooks</a></li>
<li class="chapter" data-level="3.6.7" data-path="data-import.html"><a href="data-import.html#non-rectangular-data---many-worksheets---single-workbook"><i class="fa fa-check"></i><b>3.6.7</b> Non-rectangular data - many worksheets - single workbook</a></li>
<li class="chapter" data-level="3.6.8" data-path="data-import.html"><a href="data-import.html#non-rectangular-data---many-worksheets---many-workbooks"><i class="fa fa-check"></i><b>3.6.8</b> Non-rectangular data - many worksheets - many workbooks</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data-import.html"><a href="data-import.html#exporting-to-.xlsx"><i class="fa fa-check"></i><b>3.7</b> Exporting to .xlsx</a></li>
<li class="chapter" data-level="3.8" data-path="data-import.html"><a href="data-import.html#sav"><i class="fa fa-check"></i><b>3.8</b> .sav</a></li>
<li class="chapter" data-level="3.9" data-path="data-import.html"><a href="data-import.html#sql"><i class="fa fa-check"></i><b>3.9</b> SQL</a></li>
<li class="chapter" data-level="3.10" data-path="data-import.html"><a href="data-import.html#gcp"><i class="fa fa-check"></i><b>3.10</b> GCP</a><ul>
<li class="chapter" data-level="3.10.1" data-path="data-import.html"><a href="data-import.html#bigquery"><i class="fa fa-check"></i><b>3.10.1</b> BigQuery</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="data-import.html"><a href="data-import.html#copy-data-to-clipboard"><i class="fa fa-check"></i><b>3.11</b> Copy data to clipboard</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>4</b> Table/Data Frame manipulation</a><ul>
<li class="chapter" data-level="4.1" data-path="tables.html"><a href="tables.html#pivot-and-reshape-tables"><i class="fa fa-check"></i><b>4.1</b> Pivot and reshape tables</a></li>
<li class="chapter" data-level="4.2" data-path="tables.html"><a href="tables.html#dropping-and-selecting-columns"><i class="fa fa-check"></i><b>4.2</b> Dropping and selecting columns</a></li>
<li class="chapter" data-level="4.3" data-path="tables.html"><a href="tables.html#rename-variables"><i class="fa fa-check"></i><b>4.3</b> Rename variables</a></li>
<li class="chapter" data-level="4.4" data-path="tables.html"><a href="tables.html#filtering-data"><i class="fa fa-check"></i><b>4.4</b> Filtering data</a></li>
<li class="chapter" data-level="4.5" data-path="tables.html"><a href="tables.html#group-data"><i class="fa fa-check"></i><b>4.5</b> Group data</a></li>
<li class="chapter" data-level="4.6" data-path="tables.html"><a href="tables.html#order-data"><i class="fa fa-check"></i><b>4.6</b> Order data</a></li>
<li class="chapter" data-level="4.7" data-path="tables.html"><a href="tables.html#get-counts-of-data"><i class="fa fa-check"></i><b>4.7</b> Get counts of data</a></li>
<li class="chapter" data-level="4.8" data-path="tables.html"><a href="tables.html#combine-tables"><i class="fa fa-check"></i><b>4.8</b> Combine tables</a></li>
<li class="chapter" data-level="4.9" data-path="tables.html"><a href="tables.html#joining-tables"><i class="fa fa-check"></i><b>4.9</b> Joining tables</a></li>
<li class="chapter" data-level="4.10" data-path="tables.html"><a href="tables.html#select-specific-columns-in-a-join"><i class="fa fa-check"></i><b>4.10</b> Select specific columns in a join</a></li>
<li class="chapter" data-level="4.11" data-path="tables.html"><a href="tables.html#sum-rows-or-columns"><i class="fa fa-check"></i><b>4.11</b> Sum rows or columns</a><ul>
<li class="chapter" data-level="4.11.1" data-path="tables.html"><a href="tables.html#sum-rows"><i class="fa fa-check"></i><b>4.11.1</b> Sum rows</a></li>
<li class="chapter" data-level="4.11.2" data-path="tables.html"><a href="tables.html#sum-columns"><i class="fa fa-check"></i><b>4.11.2</b> Sum columns</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="tables.html"><a href="tables.html#replace-nas-or-other-values"><i class="fa fa-check"></i><b>4.12</b> Replace NAs or other values</a></li>
<li class="chapter" data-level="4.13" data-path="tables.html"><a href="tables.html#reordering-rowscolumns"><i class="fa fa-check"></i><b>4.13</b> Reordering rows/columns</a><ul>
<li class="chapter" data-level="4.13.1" data-path="tables.html"><a href="tables.html#reordering-rows"><i class="fa fa-check"></i><b>4.13.1</b> Reordering rows</a></li>
<li class="chapter" data-level="4.13.2" data-path="tables.html"><a href="tables.html#reordering-columns"><i class="fa fa-check"></i><b>4.13.2</b> Reordering columns</a></li>
</ul></li>
<li class="chapter" data-level="4.14" data-path="tables.html"><a href="tables.html#creating-new-variables"><i class="fa fa-check"></i><b>4.14</b> Creating new variables</a></li>
<li class="chapter" data-level="4.15" data-path="tables.html"><a href="tables.html#summarising-data"><i class="fa fa-check"></i><b>4.15</b> Summarising data</a></li>
<li class="chapter" data-level="4.16" data-path="tables.html"><a href="tables.html#look-up-tables"><i class="fa fa-check"></i><b>4.16</b> Look up tables</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dates-times.html"><a href="dates-times.html"><i class="fa fa-check"></i><b>5</b> Working with dates and times</a><ul>
<li class="chapter" data-level="5.1" data-path="dates-times.html"><a href="dates-times.html#working-with-dates"><i class="fa fa-check"></i><b>5.1</b> Working with dates</a><ul>
<li class="chapter" data-level="5.1.1" data-path="dates-times.html"><a href="dates-times.html#converting-a-character-to-a-date"><i class="fa fa-check"></i><b>5.1.1</b> Converting a character to a date</a></li>
<li class="chapter" data-level="5.1.2" data-path="dates-times.html"><a href="dates-times.html#get-year-from-date"><i class="fa fa-check"></i><b>5.1.2</b> Get year from date</a></li>
<li class="chapter" data-level="5.1.3" data-path="dates-times.html"><a href="dates-times.html#get-month-from-date"><i class="fa fa-check"></i><b>5.1.3</b> Get month from date</a></li>
<li class="chapter" data-level="5.1.4" data-path="dates-times.html"><a href="dates-times.html#get-day-from-date"><i class="fa fa-check"></i><b>5.1.4</b> Get day from date</a></li>
<li class="chapter" data-level="5.1.5" data-path="dates-times.html"><a href="dates-times.html#get-weekday-from-date"><i class="fa fa-check"></i><b>5.1.5</b> Get weekday from date</a></li>
<li class="chapter" data-level="5.1.6" data-path="dates-times.html"><a href="dates-times.html#get-quarter-from-date"><i class="fa fa-check"></i><b>5.1.6</b> Get quarter from date</a></li>
<li class="chapter" data-level="5.1.7" data-path="dates-times.html"><a href="dates-times.html#find-difference-between-two-dates"><i class="fa fa-check"></i><b>5.1.7</b> Find difference between two dates</a></li>
<li class="chapter" data-level="5.1.8" data-path="dates-times.html"><a href="dates-times.html#convert-month-integer-to-character"><i class="fa fa-check"></i><b>5.1.8</b> Convert month (integer to character)</a></li>
<li class="chapter" data-level="5.1.9" data-path="dates-times.html"><a href="dates-times.html#convert-month-character-to-integer"><i class="fa fa-check"></i><b>5.1.9</b> Convert month (character to integer)</a></li>
<li class="chapter" data-level="5.1.10" data-path="dates-times.html"><a href="dates-times.html#merge-separate-date-information-into-a-date"><i class="fa fa-check"></i><b>5.1.10</b> Merge separate date information into a date</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dates-times.html"><a href="dates-times.html#working-with-date-times"><i class="fa fa-check"></i><b>5.2</b> Working with date-times</a><ul>
<li class="chapter" data-level="5.2.1" data-path="dates-times.html"><a href="dates-times.html#converting-a-character-to-a-date-time"><i class="fa fa-check"></i><b>5.2.1</b> Converting a character to a date-time</a></li>
<li class="chapter" data-level="5.2.2" data-path="dates-times.html"><a href="dates-times.html#extract-date-from-date-time-variable"><i class="fa fa-check"></i><b>5.2.2</b> Extract date from date time variable</a></li>
<li class="chapter" data-level="5.2.3" data-path="dates-times.html"><a href="dates-times.html#convert-character-to-hms-time-variable"><i class="fa fa-check"></i><b>5.2.3</b> Convert character to hms (time) variable</a></li>
<li class="chapter" data-level="5.2.4" data-path="dates-times.html"><a href="dates-times.html#extract-hour-from-time"><i class="fa fa-check"></i><b>5.2.4</b> Extract hour from time</a></li>
<li class="chapter" data-level="5.2.5" data-path="dates-times.html"><a href="dates-times.html#extract-minute-from-time"><i class="fa fa-check"></i><b>5.2.5</b> Extract minute from time</a></li>
<li class="chapter" data-level="5.2.6" data-path="dates-times.html"><a href="dates-times.html#extract-second-from-time"><i class="fa fa-check"></i><b>5.2.6</b> Extract second from time</a></li>
<li class="chapter" data-level="5.2.7" data-path="dates-times.html"><a href="dates-times.html#merge-separate-time-information-into-one-variable"><i class="fa fa-check"></i><b>5.2.7</b> Merge separate time information into one variable</a></li>
<li class="chapter" data-level="5.2.8" data-path="dates-times.html"><a href="dates-times.html#find-the-difference-between-two-times"><i class="fa fa-check"></i><b>5.2.8</b> find the difference between two times</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>6</b> Working with factors</a><ul>
<li class="chapter" data-level="6.1" data-path="factors.html"><a href="factors.html#common-uses"><i class="fa fa-check"></i><b>6.1</b> Common uses</a><ul>
<li class="chapter" data-level="6.1.1" data-path="factors.html"><a href="factors.html#tabulation-of-data"><i class="fa fa-check"></i><b>6.1.1</b> Tabulation of data</a></li>
<li class="chapter" data-level="6.1.2" data-path="factors.html"><a href="factors.html#ordering-of-data-for-output"><i class="fa fa-check"></i><b>6.1.2</b> Ordering of data for output</a></li>
<li class="chapter" data-level="6.1.3" data-path="factors.html"><a href="factors.html#statistical-models"><i class="fa fa-check"></i><b>6.1.3</b> Statistical models</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="factors.html"><a href="factors.html#other-things-to-know-about-factors"><i class="fa fa-check"></i><b>6.2</b> Other things to know about factors</a><ul>
<li class="chapter" data-level="6.2.1" data-path="factors.html"><a href="factors.html#renaming-factor-levels"><i class="fa fa-check"></i><b>6.2.1</b> Renaming factor levels</a></li>
<li class="chapter" data-level="6.2.2" data-path="factors.html"><a href="factors.html#combining-factors-does-not-result-in-a-factor"><i class="fa fa-check"></i><b>6.2.2</b> Combining factors does not result in a factor</a></li>
<li class="chapter" data-level="6.2.3" data-path="factors.html"><a href="factors.html#numeric-vectors-that-have-been-read-as-factors"><i class="fa fa-check"></i><b>6.2.3</b> Numeric vectors that have been read as factors</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="factors.html"><a href="factors.html#helpful-packages"><i class="fa fa-check"></i><b>6.3</b> Helpful packages</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plots.html"><a href="plots.html"><i class="fa fa-check"></i><b>7</b> Plotting and Data Visualisations</a><ul>
<li class="chapter" data-level="7.1" data-path="plots.html"><a href="plots.html#plotting-in-base-r"><i class="fa fa-check"></i><b>7.1</b> Plotting in base R</a><ul>
<li class="chapter" data-level="7.1.1" data-path="plots.html"><a href="plots.html#line-charts-in-base-r"><i class="fa fa-check"></i><b>7.1.1</b> Line charts in base R</a></li>
<li class="chapter" data-level="7.1.2" data-path="plots.html"><a href="plots.html#bar-charts-in-base-r"><i class="fa fa-check"></i><b>7.1.2</b> Bar charts in base R</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="plots.html"><a href="plots.html#plotting-withh-ggplot2"><i class="fa fa-check"></i><b>7.2</b> Plotting withh {ggplot2}</a><ul>
<li class="chapter" data-level="7.2.1" data-path="plots.html"><a href="plots.html#line-charts-with-ggplot2"><i class="fa fa-check"></i><b>7.2.1</b> Line charts with {ggplot2}</a></li>
<li class="chapter" data-level="7.2.2" data-path="plots.html"><a href="plots.html#aesthetic-mappings"><i class="fa fa-check"></i><b>7.2.2</b> Aesthetic mappings</a></li>
<li class="chapter" data-level="7.2.3" data-path="plots.html"><a href="plots.html#bar-charts-with-ggplot2"><i class="fa fa-check"></i><b>7.2.3</b> Bar charts with {ggplot2}</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="plots.html"><a href="plots.html#dft-colours"><i class="fa fa-check"></i><b>7.3</b> DfT colours</a></li>
<li class="chapter" data-level="7.4" data-path="plots.html"><a href="plots.html#dft-theme"><i class="fa fa-check"></i><b>7.4</b> DfT Theme</a><ul>
<li class="chapter" data-level="7.4.1" data-path="plots.html"><a href="plots.html#custom-dft-theme"><i class="fa fa-check"></i><b>7.4.1</b> Custom DfT Theme</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="plots.html"><a href="plots.html#more-ggplot2-charts"><i class="fa fa-check"></i><b>7.5</b> More {ggplot2} charts</a><ul>
<li class="chapter" data-level="7.5.1" data-path="plots.html"><a href="plots.html#scatter-plots"><i class="fa fa-check"></i><b>7.5.1</b> Scatter plots</a></li>
<li class="chapter" data-level="7.5.2" data-path="plots.html"><a href="plots.html#horizontal-bar-chart"><i class="fa fa-check"></i><b>7.5.2</b> Horizontal bar chart</a></li>
<li class="chapter" data-level="7.5.3" data-path="plots.html"><a href="plots.html#stacked-bar-chart"><i class="fa fa-check"></i><b>7.5.3</b> Stacked bar chart</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="plots.html"><a href="plots.html#interactive-charts-with-plotly"><i class="fa fa-check"></i><b>7.6</b> Interactive charts with {plotly}</a><ul>
<li class="chapter" data-level="7.6.1" data-path="plots.html"><a href="plots.html#plotly-with-ggplot2"><i class="fa fa-check"></i><b>7.6.1</b> {plotly} with {ggplot2}</a></li>
<li class="chapter" data-level="7.6.2" data-path="plots.html"><a href="plots.html#plot_ly"><i class="fa fa-check"></i><b>7.6.2</b> plot_ly()</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="plots.html"><a href="plots.html#mapping-in-r"><i class="fa fa-check"></i><b>7.7</b> Mapping in R</a><ul>
<li class="chapter" data-level="7.7.1" data-path="plots.html"><a href="plots.html#mapping-with-ggplot2"><i class="fa fa-check"></i><b>7.7.1</b> Mapping with {ggplot2}</a></li>
<li class="chapter" data-level="7.7.2" data-path="plots.html"><a href="plots.html#mapping-with-leaflet"><i class="fa fa-check"></i><b>7.7.2</b> Mapping with {leaflet}</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="RAP.html"><a href="RAP.html"><i class="fa fa-check"></i><b>8</b> DfT RAP guidance</a><ul>
<li class="chapter" data-level="8.1" data-path="RAP.html"><a href="RAP.html#what"><i class="fa fa-check"></i><b>8.1</b> What</a></li>
<li class="chapter" data-level="8.2" data-path="RAP.html"><a href="RAP.html#when"><i class="fa fa-check"></i><b>8.2</b> When</a></li>
<li class="chapter" data-level="8.3" data-path="RAP.html"><a href="RAP.html#additional-resources"><i class="fa fa-check"></i><b>8.3</b> Additional resources</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>9</b> Spatial Analysis in R</a><ul>
<li class="chapter" data-level="9.1" data-path="spatial.html"><a href="spatial.html#what-is-spatial-data"><i class="fa fa-check"></i><b>9.1</b> What is Spatial Data?</a></li>
<li class="chapter" data-level="9.2" data-path="spatial.html"><a href="spatial.html#packages"><i class="fa fa-check"></i><b>9.2</b> Packages</a></li>
<li class="chapter" data-level="9.3" data-path="spatial.html"><a href="spatial.html#reading-in-spatial-data"><i class="fa fa-check"></i><b>9.3</b> Reading in Spatial Data</a></li>
<li class="chapter" data-level="9.4" data-path="spatial.html"><a href="spatial.html#crs-projections"><i class="fa fa-check"></i><b>9.4</b> CRS Projections</a></li>
<li class="chapter" data-level="9.5" data-path="spatial.html"><a href="spatial.html#manipulating-spatial-data"><i class="fa fa-check"></i><b>9.5</b> Manipulating Spatial Data</a></li>
<li class="chapter" data-level="9.6" data-path="spatial.html"><a href="spatial.html#spatial-analysis---joins"><i class="fa fa-check"></i><b>9.6</b> Spatial Analysis - Joins</a></li>
<li class="chapter" data-level="9.7" data-path="spatial.html"><a href="spatial.html#plotting-and-simplifying"><i class="fa fa-check"></i><b>9.7</b> Plotting and simplifying</a></li>
<li class="chapter" data-level="9.8" data-path="spatial.html"><a href="spatial.html#mapping-spatial-data"><i class="fa fa-check"></i><b>9.8</b> Mapping Spatial Data</a></li>
<li class="chapter" data-level="9.9" data-path="spatial.html"><a href="spatial.html#other-spatial-types"><i class="fa fa-check"></i><b>9.9</b> Other Spatial Types</a></li>
<li class="chapter" data-level="9.10" data-path="spatial.html"><a href="spatial.html#further-resources"><i class="fa fa-check"></i><b>9.10</b> Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>10</b> Functions</a><ul>
<li class="chapter" data-level="10.1" data-path="functions.html"><a href="functions.html#user-defined-functions-udfs"><i class="fa fa-check"></i><b>10.1</b> User defined functions (UDFs)</a></li>
<li class="chapter" data-level="10.2" data-path="functions.html"><a href="functions.html#top-tips-for-writing-functions"><i class="fa fa-check"></i><b>10.2</b> Top tips for writing functions</a></li>
<li class="chapter" data-level="10.3" data-path="functions.html"><a href="functions.html#function-structure"><i class="fa fa-check"></i><b>10.3</b> Function structure</a></li>
<li class="chapter" data-level="10.4" data-path="functions.html"><a href="functions.html#function-with-purrr-structure"><i class="fa fa-check"></i><b>10.4</b> Function with <code>purrr</code> structure</a></li>
<li class="chapter" data-level="10.5" data-path="functions.html"><a href="functions.html#add-superscript-to-text-function"><i class="fa fa-check"></i><b>10.5</b> Add superscript to text function</a></li>
<li class="chapter" data-level="10.6" data-path="functions.html"><a href="functions.html#function-to-produce-multiple-graphs"><i class="fa fa-check"></i><b>10.6</b> Function to produce multiple graphs</a></li>
<li class="chapter" data-level="10.7" data-path="functions.html"><a href="functions.html#further-reading"><i class="fa fa-check"></i><b>10.7</b> Further reading</a></li>
<li class="chapter" data-level="10.8" data-path="functions.html"><a href="functions.html#function-to-create-folder-structure-for-r-project"><i class="fa fa-check"></i><b>10.8</b> Function to create folder structure for R project</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DfT R Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> Functions</h1>
<p>This chapter contains the basics of how to write a function, links to more complete instructions, and examples of functions.</p>
<div id="user-defined-functions-udfs" class="section level2">
<h2><span class="header-section-number">10.1</span> User defined functions (UDFs)</h2>
<p>A non-exhaustive list of possible reasons for writing your own UDF,</p>
<ul>
<li>you are repeating some code chunk changing only a few variables each time.</li>
<li>you want to apply the same set of commands to multiple instances of some object: it might be a dataframe, a text string, a document, an image etc.</li>
<li>tidier code, you can write the functions in a separate R file and load these functions by running that file when you load other packages.</li>
<li>easier to update, just update the function rather than edit potentially multiple code chunks.</li>
<li>prevents copy/paste errors</li>
<li>you are writing a package/library</li>
</ul>
</div>
<div id="top-tips-for-writing-functions" class="section level2">
<h2><span class="header-section-number">10.2</span> Top tips for writing functions</h2>
<ul>
<li>name the function something sensible that gives you a clue what it does, usually containing a verb, and making sure that it doesn’t conflict with names of other functions in use.</li>
<li>write some description of what the function is intended for and the expected outcome, including what it needs to work properly, eg it might take an integer value argument only, and therefore fail if given a double.</li>
<li>make your function as independent as possible, use <code>name_space::function</code> syntax if it uses functions from other packages so they don’t have to be loaded (they will have to be installed though).</li>
<li>recommend passing named arguments rather than relying on global variables (again name your arguments clearly).</li>
<li>recommend giving arguments default values, this shows an example of the type of variable that is expected here.</li>
<li>note that variables assigned inside a function will not appear in the global environment unless explicitly returned.</li>
<li>using an explicit return statement is useful if the function is complex, otherwise the output will be the final evaluated expression.</li>
</ul>
</div>
<div id="function-structure" class="section level2">
<h2><span class="header-section-number">10.3</span> Function structure</h2>
<p>Below is an example of the syntax for defining a function named <code>state_animal_age</code>. The list of named arguments are included in brackets <code>()</code> with defaults. The function code sits inside braces <code>{}</code>, and returns a single string of the concatenated inputs.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="functions.html#cb243-1"></a>state_animal_age &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">animal =</span> <span class="st">&quot;animal type&quot;</span>, <span class="dt">age =</span> <span class="dv">0</span>) {</span>
<span id="cb243-2"><a href="functions.html#cb243-2"></a>  <span class="co">#function takes animal name as a string and current age and pastes them together</span></span>
<span id="cb243-3"><a href="functions.html#cb243-3"></a>  <span class="co">#output is single string</span></span>
<span id="cb243-4"><a href="functions.html#cb243-4"></a>  <span class="kw">return</span>( <span class="kw">paste</span>(animal, age, <span class="dt">sep =</span> <span class="st">&#39;: &#39;</span>) )</span>
<span id="cb243-5"><a href="functions.html#cb243-5"></a>}</span>
<span id="cb243-6"><a href="functions.html#cb243-6"></a></span>
<span id="cb243-7"><a href="functions.html#cb243-7"></a><span class="co">#run function with defaults</span></span>
<span id="cb243-8"><a href="functions.html#cb243-8"></a><span class="kw">state_animal_age</span>()</span>
<span id="cb243-9"><a href="functions.html#cb243-9"></a><span class="co">#&gt; [1] &quot;animal type: 0&quot;</span></span>
<span id="cb243-10"><a href="functions.html#cb243-10"></a></span>
<span id="cb243-11"><a href="functions.html#cb243-11"></a><span class="co">#run function passing inputs to argument names, order doesn&#39;t matter</span></span>
<span id="cb243-12"><a href="functions.html#cb243-12"></a><span class="kw">state_animal_age</span>(<span class="dt">age =</span> <span class="dv">2</span>, <span class="dt">animal =</span> <span class="st">&quot;potoo&quot;</span>)</span>
<span id="cb243-13"><a href="functions.html#cb243-13"></a><span class="co">#&gt; [1] &quot;potoo: 2&quot;</span></span>
<span id="cb243-14"><a href="functions.html#cb243-14"></a></span>
<span id="cb243-15"><a href="functions.html#cb243-15"></a><span class="co">#run function passing inputs by position, order matters</span></span>
<span id="cb243-16"><a href="functions.html#cb243-16"></a><span class="kw">state_animal_age</span>(<span class="st">&quot;tortoise&quot;</span>, <span class="dv">169</span>)</span>
<span id="cb243-17"><a href="functions.html#cb243-17"></a><span class="co">#&gt; [1] &quot;tortoise: 169&quot;</span></span></code></pre></div>
</div>
<div id="function-with-purrr-structure" class="section level2">
<h2><span class="header-section-number">10.4</span> Function with <code>purrr</code> structure</h2>
<p>The scenario in which I most find myself writing functions is when I want to do the same thing to a set of similar objects. I write a function that does what I want to one object and then use <code>purrr::map</code> (or one of its siblings) to iterate through the complete list of objects. This greatly simplifies the entire process. For examples see Chapter 3 <strong>.xlsx and .xls</strong> section and below.</p>
<p>Using the function above that takes two inputs I can use <code>purrr::map2</code> to iterate over two lists of these input values. Note that the corresponding values in each list form a pair of inputs for the function, so we get three outputs. Consider how this is different to iterating over nested lists, where, in this case, we would get nine outputs.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="functions.html#cb244-1"></a>animal_list =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;cat&#39;</span>, <span class="st">&#39;dog&#39;</span>, <span class="st">&#39;elephant&#39;</span>)</span>
<span id="cb244-2"><a href="functions.html#cb244-2"></a>age_list =<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">7</span>, <span class="dv">42</span>)</span>
<span id="cb244-3"><a href="functions.html#cb244-3"></a></span>
<span id="cb244-4"><a href="functions.html#cb244-4"></a>purrr<span class="op">::</span><span class="kw">map2</span>(<span class="dt">.x =</span> animal_list, <span class="dt">.y =</span> age_list, <span class="dt">.f =</span> state_animal_age)</span>
<span id="cb244-5"><a href="functions.html#cb244-5"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb244-6"><a href="functions.html#cb244-6"></a><span class="co">#&gt; [1] &quot;cat: 12&quot;</span></span>
<span id="cb244-7"><a href="functions.html#cb244-7"></a><span class="co">#&gt; </span></span>
<span id="cb244-8"><a href="functions.html#cb244-8"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb244-9"><a href="functions.html#cb244-9"></a><span class="co">#&gt; [1] &quot;dog: 7&quot;</span></span>
<span id="cb244-10"><a href="functions.html#cb244-10"></a><span class="co">#&gt; </span></span>
<span id="cb244-11"><a href="functions.html#cb244-11"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb244-12"><a href="functions.html#cb244-12"></a><span class="co">#&gt; [1] &quot;elephant: 42&quot;</span></span></code></pre></div>
</div>
<div id="add-superscript-to-text-function" class="section level2">
<h2><span class="header-section-number">10.5</span> Add superscript to text function</h2>
<p>A function to add superscript to text when creating excel tables in R.</p>
<p>Copy and paste the code below into R and save as it’s own file. This script can then be run before your R code to create a function that can be used to add superscripts to text.</p>
<p>An example of how to use the function is below the function code.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="functions.html#cb245-1"></a><span class="co">#&#39; Writes text to a cell within a workbook object and adds a superscript or a subscript</span></span>
<span id="cb245-2"><a href="functions.html#cb245-2"></a><span class="co">#</span></span>
<span id="cb245-3"><a href="functions.html#cb245-3"></a><span class="co">#&#39; @param wb A workbook object</span></span>
<span id="cb245-4"><a href="functions.html#cb245-4"></a><span class="co">#&#39; @param sheet A sheet within the workbook object</span></span>
<span id="cb245-5"><a href="functions.html#cb245-5"></a><span class="co">#&#39; @param row The row number you want to write to</span></span>
<span id="cb245-6"><a href="functions.html#cb245-6"></a><span class="co">#&#39; @param col The column number you want to write to</span></span>
<span id="cb245-7"><a href="functions.html#cb245-7"></a><span class="co">#&#39; @param text The text (not including the superscript) you want written.</span></span>
<span id="cb245-8"><a href="functions.html#cb245-8"></a><span class="co">#&#39; @param superScriptText The text you want in the superscript</span></span>
<span id="cb245-9"><a href="functions.html#cb245-9"></a><span class="co">#&#39; @param position A number specifying how far along in the text you want the superscript to occur. Defaults to nchar(text), (ie, the last position)</span></span>
<span id="cb245-10"><a href="functions.html#cb245-10"></a><span class="co">#&#39; @param superOrSub TRUE or FALSE is you want to return a superscript or a subscript. Defaults to superscript (TRUE)</span></span>
<span id="cb245-11"><a href="functions.html#cb245-11"></a><span class="co">#&#39; @param size The size of the font. Defaults to 10</span></span>
<span id="cb245-12"><a href="functions.html#cb245-12"></a><span class="co">#&#39; @param colour The hex code of the colour of the text. Defaults to black (000000) </span></span>
<span id="cb245-13"><a href="functions.html#cb245-13"></a><span class="co">#&#39; @param font The font. Defaults to Arial</span></span>
<span id="cb245-14"><a href="functions.html#cb245-14"></a><span class="co">#&#39; @param family Not sure what this is for. Leave it alone at 2 if you don&#39;t know either</span></span>
<span id="cb245-15"><a href="functions.html#cb245-15"></a><span class="co">#&#39; @param bold TRUE or FALSE if you want text to be bold</span></span>
<span id="cb245-16"><a href="functions.html#cb245-16"></a><span class="co">#&#39; @param italic TRUE or FALSE if you want text to be italic</span></span>
<span id="cb245-17"><a href="functions.html#cb245-17"></a><span class="co">#&#39; @param underlined TRUE or FALSE if you want text to be underlined</span></span>
<span id="cb245-18"><a href="functions.html#cb245-18"></a></span>
<span id="cb245-19"><a href="functions.html#cb245-19"></a></span>
<span id="cb245-20"><a href="functions.html#cb245-20"></a>addSuperScriptToCell &lt;-<span class="st"> </span><span class="cf">function</span>(wb,</span>
<span id="cb245-21"><a href="functions.html#cb245-21"></a>                                 sheet,</span>
<span id="cb245-22"><a href="functions.html#cb245-22"></a>                                 row,</span>
<span id="cb245-23"><a href="functions.html#cb245-23"></a>                                 col,</span>
<span id="cb245-24"><a href="functions.html#cb245-24"></a>                                 text,</span>
<span id="cb245-25"><a href="functions.html#cb245-25"></a>                                 superScriptText,</span>
<span id="cb245-26"><a href="functions.html#cb245-26"></a>                                 <span class="dt">position =</span> <span class="kw">nchar</span>(text),</span>
<span id="cb245-27"><a href="functions.html#cb245-27"></a>                                 <span class="dt">superOrSub =</span> <span class="ot">TRUE</span>,</span>
<span id="cb245-28"><a href="functions.html#cb245-28"></a>                                 <span class="dt">size =</span> <span class="st">&#39;8&#39;</span>,</span>
<span id="cb245-29"><a href="functions.html#cb245-29"></a>                                 <span class="dt">colour =</span> <span class="st">&#39;000000&#39;</span>,</span>
<span id="cb245-30"><a href="functions.html#cb245-30"></a>                                 <span class="dt">font =</span> <span class="st">&#39;Arial&#39;</span>,</span>
<span id="cb245-31"><a href="functions.html#cb245-31"></a>                                 <span class="dt">family =</span> <span class="st">&#39;2&#39;</span>,</span>
<span id="cb245-32"><a href="functions.html#cb245-32"></a>                                 <span class="dt">bold =</span> <span class="ot">FALSE</span>,</span>
<span id="cb245-33"><a href="functions.html#cb245-33"></a>                                 <span class="dt">italic =</span> <span class="ot">FALSE</span>,</span>
<span id="cb245-34"><a href="functions.html#cb245-34"></a>                                 <span class="dt">underlined =</span> <span class="ot">FALSE</span>){</span>
<span id="cb245-35"><a href="functions.html#cb245-35"></a>  </span>
<span id="cb245-36"><a href="functions.html#cb245-36"></a>  placeholderText &lt;-<span class="st"> &#39;This is placeholder text that should not appear anywhere in your document.&#39;</span></span>
<span id="cb245-37"><a href="functions.html#cb245-37"></a>  </span>
<span id="cb245-38"><a href="functions.html#cb245-38"></a>  openxlsx<span class="op">::</span><span class="kw">writeData</span>(<span class="dt">wb =</span> wb,</span>
<span id="cb245-39"><a href="functions.html#cb245-39"></a>                      <span class="dt">sheet =</span> sheet,</span>
<span id="cb245-40"><a href="functions.html#cb245-40"></a>                      <span class="dt">x =</span> placeholderText,</span>
<span id="cb245-41"><a href="functions.html#cb245-41"></a>                      <span class="dt">startRow =</span> row,</span>
<span id="cb245-42"><a href="functions.html#cb245-42"></a>                      <span class="dt">startCol =</span> col)</span>
<span id="cb245-43"><a href="functions.html#cb245-43"></a>  </span>
<span id="cb245-44"><a href="functions.html#cb245-44"></a>  <span class="co">#finds the string that you want to update</span></span>
<span id="cb245-45"><a href="functions.html#cb245-45"></a>  stringToUpdate &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">sapply</span>(wb<span class="op">$</span>sharedStrings,</span>
<span id="cb245-46"><a href="functions.html#cb245-46"></a>                                 <span class="cf">function</span>(x){</span>
<span id="cb245-47"><a href="functions.html#cb245-47"></a>                                   <span class="kw">grep</span>(<span class="dt">pattern =</span> placeholderText,</span>
<span id="cb245-48"><a href="functions.html#cb245-48"></a>                                        x)</span>
<span id="cb245-49"><a href="functions.html#cb245-49"></a>                                 }</span>
<span id="cb245-50"><a href="functions.html#cb245-50"></a>  )</span>
<span id="cb245-51"><a href="functions.html#cb245-51"></a>  <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb245-52"><a href="functions.html#cb245-52"></a>  </span>
<span id="cb245-53"><a href="functions.html#cb245-53"></a>  <span class="co">#splits the text into before and after the superscript</span></span>
<span id="cb245-54"><a href="functions.html#cb245-54"></a>  </span>
<span id="cb245-55"><a href="functions.html#cb245-55"></a>  preText &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_sub</span>(text,</span>
<span id="cb245-56"><a href="functions.html#cb245-56"></a>                              <span class="dv">1</span>,</span>
<span id="cb245-57"><a href="functions.html#cb245-57"></a>                              position)</span>
<span id="cb245-58"><a href="functions.html#cb245-58"></a>  </span>
<span id="cb245-59"><a href="functions.html#cb245-59"></a>  postText &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_sub</span>(text,</span>
<span id="cb245-60"><a href="functions.html#cb245-60"></a>                               position <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb245-61"><a href="functions.html#cb245-61"></a>                               <span class="kw">nchar</span>(text))</span>
<span id="cb245-62"><a href="functions.html#cb245-62"></a>  </span>
<span id="cb245-63"><a href="functions.html#cb245-63"></a>  <span class="co">#formatting instructions</span></span>
<span id="cb245-64"><a href="functions.html#cb245-64"></a>  </span>
<span id="cb245-65"><a href="functions.html#cb245-65"></a>  sz    &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&lt;sz val =</span><span class="ch">\&quot;</span><span class="st">&#39;</span>,size,<span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">/&gt;&#39;</span>,</span>
<span id="cb245-66"><a href="functions.html#cb245-66"></a>                 <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb245-67"><a href="functions.html#cb245-67"></a>  col   &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&lt;color rgb =</span><span class="ch">\&quot;</span><span class="st">&#39;</span>,colour,<span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">/&gt;&#39;</span>,</span>
<span id="cb245-68"><a href="functions.html#cb245-68"></a>                 <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb245-69"><a href="functions.html#cb245-69"></a>  rFont &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&lt;rFont val =</span><span class="ch">\&quot;</span><span class="st">&#39;</span>,font,<span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">/&gt;&#39;</span>,</span>
<span id="cb245-70"><a href="functions.html#cb245-70"></a>                 <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb245-71"><a href="functions.html#cb245-71"></a>  fam   &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&lt;family val =</span><span class="ch">\&quot;</span><span class="st">&#39;</span>,family,<span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">/&gt;&#39;</span>,</span>
<span id="cb245-72"><a href="functions.html#cb245-72"></a>                 <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb245-73"><a href="functions.html#cb245-73"></a>  <span class="cf">if</span>(superOrSub){</span>
<span id="cb245-74"><a href="functions.html#cb245-74"></a>    vert &lt;-<span class="st"> &#39;&lt;vertAlign val=</span><span class="ch">\&quot;</span><span class="st">superscript</span><span class="ch">\&quot;</span><span class="st">/&gt;&#39;</span></span>
<span id="cb245-75"><a href="functions.html#cb245-75"></a>  } <span class="cf">else</span>{vert &lt;-<span class="st"> &#39;&lt;vertAlign val=</span><span class="ch">\&quot;</span><span class="st">subscript</span><span class="ch">\&quot;</span><span class="st">/&gt;&#39;</span>}</span>
<span id="cb245-76"><a href="functions.html#cb245-76"></a>  </span>
<span id="cb245-77"><a href="functions.html#cb245-77"></a>  <span class="cf">if</span>(bold){</span>
<span id="cb245-78"><a href="functions.html#cb245-78"></a>    bld &lt;-<span class="st"> &#39;&lt;b/&gt;&#39;</span></span>
<span id="cb245-79"><a href="functions.html#cb245-79"></a>  } <span class="cf">else</span>{bld &lt;-<span class="st"> &#39;&#39;</span>}</span>
<span id="cb245-80"><a href="functions.html#cb245-80"></a>  </span>
<span id="cb245-81"><a href="functions.html#cb245-81"></a>  <span class="cf">if</span>(italic){</span>
<span id="cb245-82"><a href="functions.html#cb245-82"></a>    itl &lt;-<span class="st"> &#39;&lt;i/&gt;&#39;</span></span>
<span id="cb245-83"><a href="functions.html#cb245-83"></a>  } <span class="cf">else</span>{itl &lt;-<span class="st"> &#39;&#39;</span>}</span>
<span id="cb245-84"><a href="functions.html#cb245-84"></a>  </span>
<span id="cb245-85"><a href="functions.html#cb245-85"></a>  <span class="cf">if</span>(underlined){</span>
<span id="cb245-86"><a href="functions.html#cb245-86"></a>    uld &lt;-<span class="st"> &#39;&lt;u/&gt;&#39;</span></span>
<span id="cb245-87"><a href="functions.html#cb245-87"></a>  } <span class="cf">else</span>{uld &lt;-<span class="st"> &#39;&#39;</span>}</span>
<span id="cb245-88"><a href="functions.html#cb245-88"></a>  </span>
<span id="cb245-89"><a href="functions.html#cb245-89"></a>  <span class="co">#run properties</span></span>
<span id="cb245-90"><a href="functions.html#cb245-90"></a>  </span>
<span id="cb245-91"><a href="functions.html#cb245-91"></a>  rPrText &lt;-<span class="st"> </span><span class="kw">paste</span>(sz,</span>
<span id="cb245-92"><a href="functions.html#cb245-92"></a>                   col,</span>
<span id="cb245-93"><a href="functions.html#cb245-93"></a>                   rFont,</span>
<span id="cb245-94"><a href="functions.html#cb245-94"></a>                   fam,</span>
<span id="cb245-95"><a href="functions.html#cb245-95"></a>                   bld,</span>
<span id="cb245-96"><a href="functions.html#cb245-96"></a>                   itl,</span>
<span id="cb245-97"><a href="functions.html#cb245-97"></a>                   uld,</span>
<span id="cb245-98"><a href="functions.html#cb245-98"></a>                   <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb245-99"><a href="functions.html#cb245-99"></a>  </span>
<span id="cb245-100"><a href="functions.html#cb245-100"></a>  rPrSuperText &lt;-<span class="st"> </span><span class="kw">paste</span>(vert,</span>
<span id="cb245-101"><a href="functions.html#cb245-101"></a>                        sz,</span>
<span id="cb245-102"><a href="functions.html#cb245-102"></a>                        col,</span>
<span id="cb245-103"><a href="functions.html#cb245-103"></a>                        rFont,</span>
<span id="cb245-104"><a href="functions.html#cb245-104"></a>                        fam,</span>
<span id="cb245-105"><a href="functions.html#cb245-105"></a>                        bld,</span>
<span id="cb245-106"><a href="functions.html#cb245-106"></a>                        itl,</span>
<span id="cb245-107"><a href="functions.html#cb245-107"></a>                        uld,</span>
<span id="cb245-108"><a href="functions.html#cb245-108"></a>                        <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb245-109"><a href="functions.html#cb245-109"></a>  </span>
<span id="cb245-110"><a href="functions.html#cb245-110"></a>  newString &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&lt;si&gt;&lt;r&gt;&lt;rPr&gt;&#39;</span>,</span>
<span id="cb245-111"><a href="functions.html#cb245-111"></a>                     rPrText,</span>
<span id="cb245-112"><a href="functions.html#cb245-112"></a>                     <span class="st">&#39;&lt;/rPr&gt;&lt;t xml:space=&quot;preserve&quot;&gt;&#39;</span>,</span>
<span id="cb245-113"><a href="functions.html#cb245-113"></a>                     preText,</span>
<span id="cb245-114"><a href="functions.html#cb245-114"></a>                     <span class="st">&#39;&lt;/t&gt;&lt;/r&gt;&lt;r&gt;&lt;rPr&gt;&#39;</span>,</span>
<span id="cb245-115"><a href="functions.html#cb245-115"></a>                     rPrSuperText,</span>
<span id="cb245-116"><a href="functions.html#cb245-116"></a>                     <span class="st">&#39;&lt;/rPr&gt;&lt;t xml:space=&quot;preserve&quot;&gt;&#39;</span>,</span>
<span id="cb245-117"><a href="functions.html#cb245-117"></a>                     superScriptText,</span>
<span id="cb245-118"><a href="functions.html#cb245-118"></a>                     <span class="st">&#39;&lt;/t&gt;&lt;/r&gt;&lt;r&gt;&lt;rPr&gt;&#39;</span>,</span>
<span id="cb245-119"><a href="functions.html#cb245-119"></a>                     rPrText,</span>
<span id="cb245-120"><a href="functions.html#cb245-120"></a>                     <span class="st">&#39;&lt;/rPr&gt;&lt;t xml:space=&quot;preserve&quot;&gt;&#39;</span>,</span>
<span id="cb245-121"><a href="functions.html#cb245-121"></a>                     postText,</span>
<span id="cb245-122"><a href="functions.html#cb245-122"></a>                     <span class="st">&#39;&lt;/t&gt;&lt;/r&gt;&lt;/si&gt;&#39;</span>,</span>
<span id="cb245-123"><a href="functions.html#cb245-123"></a>                     <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb245-124"><a href="functions.html#cb245-124"></a>  </span>
<span id="cb245-125"><a href="functions.html#cb245-125"></a>  wb<span class="op">$</span>sharedStrings[stringToUpdate] &lt;-<span class="st"> </span>newString</span>
<span id="cb245-126"><a href="functions.html#cb245-126"></a>}</span></code></pre></div>
<p>An example of using the superscript function in R:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="functions.html#cb246-1"></a><span class="co"># add title with superscript</span></span>
<span id="cb246-2"><a href="functions.html#cb246-2"></a><span class="co"># the superscript text specified in the function is what will appear as a superscript</span></span>
<span id="cb246-3"><a href="functions.html#cb246-3"></a><span class="kw">addSuperScriptToCell</span>(<span class="dt">wb =</span> Table1,<span class="dt">sheet =</span> <span class="st">&quot;SFR0101&quot;</span>,<span class="dt">row =</span> <span class="dv">4</span>,<span class="dt">col =</span> <span class="dv">1</span>,<span class="dt">text =</span> <span class="st">&quot;Publication table title&quot;</span>,<span class="dt">superScriptText =</span> <span class="st">&#39;1,2,3&#39;</span>)</span></code></pre></div>
<p>note: to use this function you will need to load an Excel workbook into R using the openxlsx package:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="functions.html#cb247-1"></a></span>
<span id="cb247-2"><a href="functions.html#cb247-2"></a><span class="co"># load the excel table </span></span>
<span id="cb247-3"><a href="functions.html#cb247-3"></a>Table1 &lt;-<span class="st"> </span>openxlsx<span class="op">::</span><span class="kw">loadWorkbook</span>(<span class="st">&quot;0101 template/sfr0101_template.xlsx&quot;</span>)</span></code></pre></div>
</div>
<div id="function-to-produce-multiple-graphs" class="section level2">
<h2><span class="header-section-number">10.6</span> Function to produce multiple graphs</h2>
<p>A generic function to create multiple graphs based on a list e.g. a graph for each local authority.</p>
<p>The function creates a list to iterate over to produce multiple graphs, in this case a list of local authorities.</p>
<p>The function then uses a loop to basically create a graph for each value in the list.</p>
<p>The graphs are created using ggplot, where the data being used to create the graphs is subset based on the value it is currently using from the list. So, in this case the data is subset based on each local authority in the list and a graph is created using this subset of data. This is then looped for each local authority in the list.</p>
<p>The function saves each graph as a png file in the working directory.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="functions.html#cb248-1"></a></span>
<span id="cb248-2"><a href="functions.html#cb248-2"></a><span class="co"># create graphing function</span></span>
<span id="cb248-3"><a href="functions.html#cb248-3"></a>    multiple.graph &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, ...){</span>
<span id="cb248-4"><a href="functions.html#cb248-4"></a>      </span>
<span id="cb248-5"><a href="functions.html#cb248-5"></a>      <span class="co"># create list of local authorities in data to loop over </span></span>
<span id="cb248-6"><a href="functions.html#cb248-6"></a>      la_list &lt;-<span class="st"> </span><span class="kw">unique</span>(df<span class="op">$</span>local_authority)</span>
<span id="cb248-7"><a href="functions.html#cb248-7"></a>      </span>
<span id="cb248-8"><a href="functions.html#cb248-8"></a>      <span class="co"># create for loop to produce ggplot2 graphs </span></span>
<span id="cb248-9"><a href="functions.html#cb248-9"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(la_list)) { </span>
<span id="cb248-10"><a href="functions.html#cb248-10"></a>        </span>
<span id="cb248-11"><a href="functions.html#cb248-11"></a>        <span class="co"># create plot for each LA in df </span></span>
<span id="cb248-12"><a href="functions.html#cb248-12"></a>        plot &lt;-<span class="st"> </span></span>
<span id="cb248-13"><a href="functions.html#cb248-13"></a><span class="st">          </span><span class="kw">ggplot</span>(<span class="kw">subset</span>(df, df<span class="op">$</span>local_authority<span class="op">==</span>la_list[i]),</span>
<span id="cb248-14"><a href="functions.html#cb248-14"></a>                 <span class="kw">aes</span>(<span class="dt">x =</span> year)) <span class="op">+</span></span>
<span id="cb248-15"><a href="functions.html#cb248-15"></a><span class="st">          </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> serious_accidents), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb248-16"><a href="functions.html#cb248-16"></a><span class="st">          </span><span class="kw">ylab</span>(<span class="st">&quot;serious accident count&quot;</span>) <span class="op">+</span></span>
<span id="cb248-17"><a href="functions.html#cb248-17"></a><span class="st">          </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></span>
<span id="cb248-18"><a href="functions.html#cb248-18"></a><span class="st">          </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb248-19"><a href="functions.html#cb248-19"></a><span class="st">          </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(la_list[i], <span class="st">&quot;comparison chart&quot;</span>))    <span class="co"># this produces a dynamic title which is updated based on the local authority currently being used from the list</span></span>
<span id="cb248-20"><a href="functions.html#cb248-20"></a></span>
<span id="cb248-21"><a href="functions.html#cb248-21"></a>        </span>
<span id="cb248-22"><a href="functions.html#cb248-22"></a>         <span class="co"># save plots as .png</span></span>
<span id="cb248-23"><a href="functions.html#cb248-23"></a>        <span class="kw">ggsave</span>(plot, <span class="dt">file=</span><span class="kw">paste</span>(la_list[i], <span class="st">&quot;.png&quot;</span>, <span class="dt">sep=</span><span class="st">&#39;&#39;</span>), <span class="dt">scale=</span><span class="dv">2</span>)</span>
<span id="cb248-24"><a href="functions.html#cb248-24"></a>        </span>
<span id="cb248-25"><a href="functions.html#cb248-25"></a>         <span class="co"># print plots to screen</span></span>
<span id="cb248-26"><a href="functions.html#cb248-26"></a>    <span class="kw">print</span>(plot)</span>
<span id="cb248-27"><a href="functions.html#cb248-27"></a>  }</span>
<span id="cb248-28"><a href="functions.html#cb248-28"></a>    }</span>
<span id="cb248-29"><a href="functions.html#cb248-29"></a></span>
<span id="cb248-30"><a href="functions.html#cb248-30"></a><span class="co">## run function</span></span>
<span id="cb248-31"><a href="functions.html#cb248-31"></a><span class="kw">multiple.graph</span>(dataframe3)</span></code></pre></div>
</div>
<div id="further-reading" class="section level2">
<h2><span class="header-section-number">10.7</span> Further reading</h2>
<p><a href="https://r4ds.had.co.nz/functions.html">Functions chapter of R for Data Science by Hadley Wickham</a></p>
</div>
<div id="function-to-create-folder-structure-for-r-project" class="section level2">
<h2><span class="header-section-number">10.8</span> Function to create folder structure for R project</h2>

</div>
</div>









            </section>

          </div>
        </div>
      </div>
<a href="spatial.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
